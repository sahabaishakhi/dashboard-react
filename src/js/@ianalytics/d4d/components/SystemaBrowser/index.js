import React, { useEffect, useState, useMemo } from "react";
import { makeStyles } from "@material-ui/core/styles";
import { CircularProgress, Button } from "@material-ui/core";
import { TreeView } from "@material-ui/lab";
import SystemaTreeItem from "/@ianalytics/d4d/components/SystemaBrowser/TreeItem";
import { useStateValue } from "/@ianalytics/d4d/components/StateProvider";
import SystemaAPI from "goog:io.ianalytics.d4d.api.systema";
const useStyles = makeStyles({
  root: {
    height: "100%",
    flexGrow: 1,
    maxWidth: "35ch"
  },
  treeView: {
    overflowY: "scroll",
    fontSize: "1rem"
  }
});
export default function SystemaBrowser(props) {
  const [state, dispatch] = useStateValue();
  const classes = useStyles();
  useEffect(() => {
    dispatch({
      type: "GET_SYSTEMA_DESCRIPTION",
      dispatch: dispatch
    });
  }, []);

  function expandNodes(tree, level = 3) {
    return [tree.uid].concat(tree.children && level > 0 ? tree.children.map(nodes => expandNodes(nodes, level - 1)).flat() : []);
  }

  function makeTree(node) {
    return /*#__PURE__*/React.createElement(SystemaTreeItem, {
      key: node.uid,
      node: node
    }, node.children ? node.children.map(child => makeTree(child)) : null);
  }

  function Browser(props) {
    return /*#__PURE__*/React.createElement("div", {
      className: classes.root
    }, /*#__PURE__*/React.createElement(Button, {
      onClick: () => dispatch({
        type: "EXPAND_ALL_SYSTEMA_NODES"
      })
    }, "Expand All"), /*#__PURE__*/React.createElement(Button, {
      onClick: () => dispatch({
        type: "COLLAPSE_ALL_SYSTEMA_NODES"
      })
    }, "Collapse All"), /*#__PURE__*/React.createElement(TreeView, {
      multiSelect: true,
      className: classes.treeView,
      defaultCollapseIcon: "-",
      defaultExpandIcon: "+",
      expanded: state.expandedSystemaNodes || (props.systema ? expandNodes(props.systema, 1) : []),
      selected: state.selectedSystemaNodes,
      onNodeToggle: (event, nodeIds) => dispatch({
        type: "UPDATE_EXPANDED_SYSTEMA_NODES",
        payload: nodeIds
      }),
      onNodeSelect: (event, nodeIds) => dispatch({
        type: "UPDATE_SELECTED_SYSTEMA_NODES",
        payload: nodeIds
      })
    }, props.systema ? makeTree(props.systema) : /*#__PURE__*/React.createElement(CircularProgress, null)));
  }

  const systema = state.systema;
  return useMemo(() => /*#__PURE__*/React.createElement(Browser, {
    systema: systema
  }), [systema, state.selectedSystemaNodes, state.expandedSystemaNodes]);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL2pzeC9AaWFuYWx5dGljcy9kNGQvY29tcG9uZW50cy9TeXN0ZW1hQnJvd3Nlci9pbmRleC5qc3giXSwibmFtZXMiOlsiUmVhY3QiLCJ1c2VFZmZlY3QiLCJ1c2VTdGF0ZSIsInVzZU1lbW8iLCJtYWtlU3R5bGVzIiwiQ2lyY3VsYXJQcm9ncmVzcyIsIkJ1dHRvbiIsIlRyZWVWaWV3IiwiU3lzdGVtYVRyZWVJdGVtIiwidXNlU3RhdGVWYWx1ZSIsIlN5c3RlbWFBUEkiLCJ1c2VTdHlsZXMiLCJyb290IiwiaGVpZ2h0IiwiZmxleEdyb3ciLCJtYXhXaWR0aCIsInRyZWVWaWV3Iiwib3ZlcmZsb3dZIiwiZm9udFNpemUiLCJTeXN0ZW1hQnJvd3NlciIsInByb3BzIiwic3RhdGUiLCJkaXNwYXRjaCIsImNsYXNzZXMiLCJ0eXBlIiwiZXhwYW5kTm9kZXMiLCJ0cmVlIiwibGV2ZWwiLCJ1aWQiLCJjb25jYXQiLCJjaGlsZHJlbiIsIm1hcCIsIm5vZGVzIiwiZmxhdCIsIm1ha2VUcmVlIiwibm9kZSIsImNoaWxkIiwiQnJvd3NlciIsImV4cGFuZGVkU3lzdGVtYU5vZGVzIiwic3lzdGVtYSIsInNlbGVjdGVkU3lzdGVtYU5vZGVzIiwiZXZlbnQiLCJub2RlSWRzIiwicGF5bG9hZCJdLCJtYXBwaW5ncyI6IkFBQUEsT0FBT0EsS0FBUCxJQUFnQkMsU0FBaEIsRUFBMkJDLFFBQTNCLEVBQXFDQyxPQUFyQyxRQUFvRCxPQUFwRDtBQUNBLFNBQVNDLFVBQVQsUUFBMkIsMEJBQTNCO0FBRUEsU0FBU0MsZ0JBQVQsRUFBMkJDLE1BQTNCLFFBQXlDLG1CQUF6QztBQUNBLFNBQVNDLFFBQVQsUUFBeUIsa0JBQXpCO0FBQ0EsT0FBT0MsZUFBUCxNQUE0QixxREFBNUI7QUFFQSxTQUFTQyxhQUFULFFBQThCLDJDQUE5QjtBQUVBLE9BQU9DLFVBQVAsTUFBdUIsb0NBQXZCO0FBRUEsTUFBTUMsU0FBUyxHQUFHUCxVQUFVLENBQUM7QUFDM0JRLEVBQUFB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LE9BQU8sRUFBRUQ7QUFGRixPQUFEO0FBakJaLE9BdUJHdEIsS0FBSyxDQUFDbUIsT0FBTixHQUNDTCxRQUFRLENBQUNkLEtBQUssQ0FBQ21CLE9BQVAsQ0FEVCxnQkFHQyxvQkFBQyxnQkFBRCxPQTFCSixDQVRGLENBREY7QUF5Q0Q7O0FBRUQsUUFBTUEsT0FBTyxHQUFHbEIsS0FBSyxDQUFDa0IsT0FBdEI7QUFFQSxTQUFPcEMsT0FBTyxDQUFDLG1CQUFNLG9CQUFDLE9BQUQ7QUFBUyxJQUFBLE9BQU8sRUFBRW9DO0FBQWxCLElBQVAsRUFBOEMsQ0FDMURBLE9BRDBELEVBRTFEbEIsS0FBSyxDQUFDbUIsb0JBRm9ELEVBRzFEbkIsS0FBSyxDQUFDaUIsb0JBSG9ELENBQTlDLENBQWQ7QUFLRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyB1c2VFZmZlY3QsIHVzZVN0YXRlLCB1c2VNZW1vIH0gZnJvbSBcInJlYWN0XCI7XHJcbmltcG9ydCB7IG1ha2VTdHlsZXMgfSBmcm9tIFwiQG1hdGVyaWFsLXVpL2NvcmUvc3R5bGVzXCI7XHJcblxyXG5pbXBvcnQgeyBDaXJjdWxhclByb2dyZXNzLCBCdXR0b24gfSBmcm9tIFwiQG1hdGVyaWFsLXVpL2NvcmVcIjtcclxuaW1wb3J0IHsgVHJlZVZpZXcgfSBmcm9tIFwiQG1hdGVyaWFsLXVpL2xhYlwiO1xyXG5pbXBvcnQgU3lzdGVtYVRyZWVJdGVtIGZyb20gXCIvQGlhbmFseXRpY3MvZDRkL2NvbXBvbmVudHMvU3lzdGVtYUJyb3dzZXIvVHJlZUl0ZW1cIjtcclxuXHJcbmltcG9ydCB7IHVzZVN0YXRlVmFsdWUgfSBmcm9tIFwiL0BpYW5hbHl0aWNzL2Q0ZC9jb21wb25lbnRzL1N0YXRlUHJvdmlkZXJcIjtcclxuXHJcbmltcG9ydCBTeXN0ZW1hQVBJIGZyb20gXCJnb29nOmlvLmlhbmFseXRpY3MuZDRkLmFwaS5zeXN0ZW1hXCI7XHJcblxyXG5jb25zdCB1c2VTdHlsZXMgPSBtYWtlU3R5bGVzKHtcclxuICByb290OiB7XHJcbiAgICBoZWlnaHQ6IFwiMTAwJVwiLFxyXG4gICAgZmxleEdyb3c6IDEsXHJcbiAgICBtYXhXaWR0aDogXCIzNWNoXCIsXHJcbiAgfSxcclxuICB0cmVlVmlldzoge1xyXG4gICAgb3ZlcmZsb3dZOiBcInNjcm9sbFwiLFxyXG4gICAgZm9udFNpemU6IFwiMXJlbVwiLFxyXG4gIH0sXHJcbn0pO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gU3lzdGVtYUJyb3dzZXIocHJvcHMpIHtcclxuICBjb25zdCBbc3RhdGUsIGRpc3BhdGNoXSA9IHVzZVN0YXRlVmFsdWUoKTtcclxuICBjb25zdCBjbGFzc2VzID0gdXNlU3R5bGVzKCk7XHJcblxyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBkaXNwYXRjaCh7IHR5cGU6IFwiR0VUX1NZU1RFTUFfREVTQ1JJUFRJT05cIiwgZGlzcGF0Y2g6IGRpc3BhdGNoIH0pO1xyXG4gIH0sIFtdKTtcclxuXHJcbiAgZnVuY3Rpb24gZXhwYW5kTm9kZXModHJlZSwgbGV2ZWwgPSAzKSB7XHJcbiAgICByZXR1cm4gW3RyZWUudWlkXS5jb25jYXQoXHJcbiAgICAgIHRyZWUuY2hpbGRyZW4gJiYgbGV2ZWwgPiAwXHJcbiAgICAgICAgPyB0cmVlLmNoaWxkcmVuLm1hcCgobm9kZXMpID0+IGV4cGFuZE5vZGVzKG5vZGVzLCBsZXZlbCAtIDEpKS5mbGF0KClcclxuICAgICAgICA6IFtdXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gbWFrZVRyZWUobm9kZSkge1xyXG4gICAgcmV0dXJuIChcclxuICAgICAgPFN5c3RlbWFUcmVlSXRlbSBrZXk9e25vZGUudWlkfSBub2RlPXtub2RlfT5cclxuICAgICAgICB7bm9kZS5jaGlsZHJlbiA/IG5vZGUuY2hpbGRyZW4ubWFwKChjaGlsZCkgPT4gbWFrZVRyZWUoY2hpbGQpKSA6IG51bGx9XHJcbiAgICAgIDwvU3lzdGVtYVRyZWVJdGVtPlxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIEJyb3dzZXIocHJvcHMpIHtcclxuICAgIHJldHVybiAoXHJcbiAgICAgIDxkaXYgY2xhc3NOYW1lPXtjbGFzc2VzLnJvb3R9PlxyXG4gICAgICAgIDxCdXR0b24gb25DbGljaz17KCkgPT4gZGlzcGF0Y2goeyB0eXBlOiBcIkVYUEFORF9BTExfU1lTVEVNQV9OT0RFU1wiIH0pfT5cclxuICAgICAgICAgIEV4cGFuZCBBbGxcclxuICAgICAgICA8L0J1dHRvbj5cclxuICAgICAgICA8QnV0dG9uXHJcbiAgICAgICAgICBvbkNsaWNrPXsoKSA9PiBkaXNwYXRjaCh7IHR5cGU6IFwiQ09MTEFQU0VfQUxMX1NZU1RFTUFfTk9ERVNcIiB9KX1cclxuICAgICAgICA+XHJcbiAgICAgICAgICBDb2xsYXBzZSBBbGxcclxuICAgICAgICA8L0J1dHRvbj5cclxuICAgICAgICA8VHJlZVZpZXdcclxuICAgICAgICAgIG11bHRpU2VsZWN0XHJcbiAgICAgICAgICBjbGFzc05hbWU9e2NsYXNzZXMudHJlZVZpZXd9XHJcbiAgICAgICAgICBkZWZhdWx0Q29sbGFwc2VJY29uPVwiLVwiXHJcbiAgICAgICAgICBkZWZhdWx0RXhwYW5kSWNvbj1cIitcIlxyXG4gICAgICAgICAgZXhwYW5kZWQ9e1xyXG4gICAgICAgICAgICBzdGF0ZS5leHBhbmRlZFN5c3RlbWFOb2RlcyB8fFxyXG4gICAgICAgICAgICAocHJvcHMuc3lzdGVtYSA/IGV4cGFuZE5vZGVzKHByb3BzLnN5c3RlbWEsIDEpIDogW10pXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBzZWxlY3RlZD17c3RhdGUuc2VsZWN0ZWRTeXN0ZW1hTm9kZXN9XHJcbiAgICAgICAgICBvbk5vZGVUb2dnbGU9eyhldmVudCwgbm9kZUlkcykgPT5cclxuICAgICAgICAgICAgZGlzcGF0Y2goe1xyXG4gICAgICAgICAgICAgIHR5cGU6IFwiVVBEQVRFX0VYUEFOREVEX1NZU1RFTUFfTk9ERVNcIixcclxuICAgICAgICAgICAgICBwYXlsb2FkOiBub2RlSWRzLFxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgb25Ob2RlU2VsZWN0PXsoZXZlbnQsIG5vZGVJZHMpID0+XHJcbiAgICAgICAgICAgIGRpc3BhdGNoKHtcclxuICAgICAgICAgICAgICB0eXBlOiBcIlVQREFURV9TRUxFQ1RFRF9TWVNURU1BX05PREVTXCIsXHJcbiAgICAgICAgICAgICAgcGF5bG9hZDogbm9kZUlkcyxcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgIH1cclxuICAgICAgICA+XHJcbiAgICAgICAgICB7cHJvcHMuc3lzdGVtYSA/IChcclxuICAgICAgICAgICAgbWFrZVRyZWUocHJvcHMuc3lzdGVtYSlcclxuICAgICAgICAgICkgOiAoXHJcbiAgICAgICAgICAgIDxDaXJjdWxhclByb2dyZXNzPjwvQ2lyY3VsYXJQcm9ncmVzcz5cclxuICAgICAgICAgICl9XHJcbiAgICAgICAgPC9UcmVlVmlldz5cclxuICAgICAgPC9kaXY+XHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgY29uc3Qgc3lzdGVtYSA9IHN0YXRlLnN5c3RlbWE7XHJcblxyXG4gIHJldHVybiB1c2VNZW1vKCgpID0+IDxCcm93c2VyIHN5c3RlbWE9e3N5c3RlbWF9PjwvQnJvd3Nlcj4sIFtcclxuICAgIHN5c3RlbWEsXHJcbiAgICBzdGF0ZS5zZWxlY3RlZFN5c3RlbWFOb2RlcyxcclxuICAgIHN0YXRlLmV4cGFuZGVkU3lzdGVtYU5vZGVzLFxyXG4gIF0pO1xyXG59XHJcbiJdfQ==