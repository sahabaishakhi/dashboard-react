import React, { useState, useMemo, useEffect } from "react";
import KRIndicator from "/@ianalytics/d4d/components/KRIndicator";
import { useStateValue } from "/@ianalytics/d4d/components/StateProvider";
import { parseISO } from "date-fns";
import { utcToZonedTime } from "date-fns-tz";
import XPlot from "react-plotly.js";
import styled from "@emotion/styled";
import { plotlyDefaults } from "/@ianalytics/d4d/theme";
import { makeAnnotations, traceColors, widthOfMeanWindowInSeconds, allPlotlyButtons, toggleEventCreationIcon, autorange } from "./plotfuns";
const Plot = XPlot.default;
import SystemaAPI from "goog:io.ianalytics.d4d.api.systema";
import TrendAPI from "goog:io.ianalytics.d4d.api.trend";
import UnitsAPI from "goog:io.ianalytics.d4d.api.units";
import { CircularProgress } from "@material-ui/core";
export default TimeSeriesPlot = function (props) {
  const [plotData, setPlotData] = useState({});
  const [fetching, setFetching] = useState(false);
  const [annotations, setAnnotations] = useState([]);
  const [shapes, setShapes] = useState([]);
  const [s, dispatch] = useStateValue();
  useEffect(() => {
    let [eventAnnotations, eventShapes] = makeAnnotations(props.uids, s);
    setAnnotations(eventAnnotations);
    setShapes(eventShapes);
  }, [props.uids, props.from, props.to, s.events, s.visibleEvents, s.pinnedEvents]);

  function updateCustomRange(newRange) {
    function correctPlotlyTimestamp(plotly_stamp) {
      return plotly_stamp ? plotly_stamp.slice(0, 10) + "T" + plotly_stamp.slice(11) : "";
    }

    dispatch({
      type: "PRESELECT_TIME_RANGE",
      payload: newRange.map(correctPlotlyTimestamp).map(parseISO)
    });
  }

  function selectTimeFromPlot() {
    dispatch({
      type: "SWITCH_TO_PRESELECTED_TIME_RANGE"
    });
  }

  function setData(jsonData, uid) {
    if (!jsonData || !jsonData.hasOwnProperty("time")) {
      return;
    }

    const dataCount = jsonData.time.length; // localize time

    const timeZone = "Europe/Berlin";
    /* TODO: make timezone configurable.  */

    const localizedTime = jsonData.time.map(ts => utcToZonedTime(parseISO(ts), timeZone));
    delete jsonData.time; // transform units

    const displayUnit = SystemaAPI.displayUnit(uid);
    const transformedValues = Object.values(jsonData).map(values => UnitsAPI.transform(values, displayUnit));
    let newTraces = {};

    for (let i = 0; i < transformedValues.length; ++i) {
      newTraces[uid + i] = {
        x: localizedTime,
        y: transformedValues[i],
        type: "scatter",
        fill: "tozeroy",
        name: `${SystemaAPI.plotTitle(uid)} ${i > 0 ? i : ""}`,
        fillcolor: traceColors[(props.uids.indexOf(uid) + i) % traceColors.length] + "22",
        line: {
          color: traceColors[(props.uids.indexOf(uid) + i) % traceColors.length]
        }
      };
    }

    setPlotData(function (data) {
      return { ...data,
        ...newTraces
      };
    });
    console.debug("read: ", Object.keys(jsonData).length - 1, // 'time' + one numerical entry for each timeseries.
    " x ", jsonData.time.length, "data points.");
  }

  function fetchData() {
    setFetching(true);
    setPlotData({});

    for (const uid of props.uids) {
      console.debug(`fetching new data for ${uid} in [${props.from}
        , ${props.to}].`);
      TrendAPI.getTrend(uid, props.from, props.to, widthOfMeanWindowInSeconds(props.from, props.to), function (data) {
        setData(data, uid);
      });
    }

    setFetching(false);
    return function () {
      setPlotData({});
    };
  }

  useEffect(fetchData, [props.uids, props.from, props.to]);

  function toggleEventCreation(from, to) {
    dispatch({
      type: "OPEN_EVENT_CREATOR",
      payload: {
        from: new Date(from),
        to: new Date(to),
        uids: props.uids
      },
      dispatch: dispatch
    });
  }

  return useMemo(() => {
    return fetching ? /*#__PURE__*/React.createElement("div", {
      style: {
        width: "60vw",
        height: "300px"
      }
    }, /*#__PURE__*/React.createElement(CircularProgress, null)) : /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(KRIndicator, {
      data: Object.values(plotData)
    }), /*#__PURE__*/React.createElement(Plot, {
      style: {
        width: "60vw",
        height: Object.keys(plotData).length <= 1 ? "300px" : "600px"
      },
      data: Object.values(plotData),
      onSelected: e => e && e.range && toggleEventCreation(e.range.x[0], e.range.x[1]),
      onUpdate: d => updateCustomRange(d.layout.xaxis.range),
      config: {
        modeBarButtonsToRemove: allPlotlyButtons,
        modeBarButtonsToAdd: [{
          name: s.plotDragMode === "zoom" ? "Create Event" : "Zoom",
          icon: toggleEventCreationIcon,
          direction: "up",
          click: () => dispatch({
            type: "TOGGLE_PLOT_EVENT_CREATION_MODE"
          })
        }, {
          name: "Use This Time Frame",
          // icon: pick one,
          direction: "up",
          click: selectTimeFromPlot
        }]
      },
      layout: { ...plotlyDefaults,
        autosize: true,
        title: { ...plotlyDefaults.title_defaults,
          text: `<b>${SystemaAPI.plotTitle(props.uids[0])}</b>`
        },
        yaxis: { ...plotlyDefaults.yaxis,
          title: `[${SystemaAPI.displayUnit(props.uids[0])}]`,
          ...(plotData && plotData !== {} ? {
            range: autorange(plotData)
          } : {})
        },
        dragmode: s.plotDragMode,
        legend: {
          orientation: "h"
        },
        selectdirection: "h",
        annotations: plotData && annotations,
        shapes: plotData && shapes
      }
    }));
  }, [plotData, annotations, shapes, fetching, s.plotDragMode]);
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL2pzeC9AaWFuYWx5dGljcy9kNGQvY29tcG9uZW50cy9QbG90L1RpbWVTZXJpZXNQbG90LmpzeCJdLCJuYW1lcyI6WyJSZWFjdCIsInVzZVN0YXRlIiwidXNlTWVtbyIsInVzZUVmZmVjdCIsIktSSW5kaWNhdG9yIiwidXNlU3RhdGVWYWx1ZSIsInBhcnNlSVNPIiwidXRjVG9ab25lZFRpbWUiLCJYUGxvdCIsInN0eWxlZCIsInBsb3RseURlZmF1bHRzIiwibWFrZUFubm90YXRpb25zIiwidHJhY2VDb2xvcnMiLCJ3aWR0aE9mTWVhbldpbmRvd0luU2Vjb25kcyIsImFsbFBsb3RseUJ1dHRvbnMiLCJ0b2dnbGVFdmVudENyZWF0aW9uSWNvbiIsImF1dG9yYW5nZSIsIlBsb3QiLCJkZWZhdWx0IiwiU3lzdGVtYUFQSSIsIlRyZW5kQVBJIiwiVW5pdHNBUEkiLCJDaXJjdWxhclByb2dyZXNzIiwiVGltZVNlcmllc1Bsb3QiLCJwcm9wcyIsInBsb3REYXRhIiwic2V0UGxvdERhdGEiLCJmZXRjaGluZyIsInNldEZldGNoaW5nIiwiYW5ub3RhdGlvbnMiLCJzZXRBbm5vdGF0aW9ucyIsInNoYXBlcyIsInNldFNoYXBlcyIsInMiLCJkaXNwYXRjaCIsImV2ZW50QW5ub3RhdGlvbnMiLCJldmVudFNoYXBlcyIsInVpZHMiLCJmcm9tIiwidG8iLCJldmVudHMiLCJ2aXNpYmxlRXZlbnRzIiwicGlubmVkRXZlbnRzIiwidXBkYXRlQ3VzdG9tUmFuZ2UiLCJuZXdSYW5nZSIsImNvcnJlY3RQbG90bHlUaW1lc3RhbXAiLCJwbG90bHlfc3RhbXAiLCJzbGljZSIsInR5cGUiLCJwYXlsb2FkIiwibWFwIiwic2VsZWN0VGltZUZyb21QbG90Iiwic2V0RGF0YSIsImpzb25EYXRhIiwidWlkIiwiaGFzT3duUHJvcGVydHkiLCJkYXRhQ291bnQiLCJ0aW1lIiwibGVuZ3RoIiwidGltZVpvbmUiLCJsb2NhbGl6ZWRUaW1lIiwidHMiLCJkaXNwbGF5VW5pdCIsInRyYW5zZm9ybWVkVmFsdWVzIiwiT2JqZWN0IiwidmFsdWVzIiwidHJhbnNmb3JtIiwibmV3VHJhY2VzIiwiaSIsIngiLCJ5IiwiZmlsbCIsIm5hbWUiLCJwbG90VGl0bGUiLCJmaWxsY29sb3IiLCJpbmRleE9mIiwibGluZSIsImNvbG9yIiwiZGF0YSIsImNvbnNvbGUiLCJkZWJ1ZyIsImtleXMiLCJmZXRjaERhdGEiLCJnZXRUcmVuZCIsInRvZ2dsZUV2ZW50Q3JlYXRpb24iLCJEYXRlIiwid2lkdGgiLCJoZWlnaHQiLCJlIiwicmFuZ2UiLCJkIiwibGF5b3V0IiwieGF4aXMiLCJtb2RlQmFyQnV0dG9uc1RvUmVtb3ZlIiwibW9kZUJhckJ1dHRvbnNUb0FkZCIsInBsb3REcmFnTW9kZSIsImljb24iLCJkaXJlY3Rpb24iLCJjbGljayIsImF1dG9zaXplIiwidGl0bGUiLCJ0aXRsZV9kZWZhdWx0cyIsInRleHQiLCJ5YXhpcyIsImRyYWdtb2RlIiwibGVnZW5kIiwib3JpZW50YXRpb24iLCJzZWxlY3RkaXJlY3Rpb24iXSwibWFwcGluZ3MiOiJBQUFBLE9BQU9BLEtBQVAsSUFBZ0JDLFFBQWhCLEVBQTBCQyxPQUExQixFQUFtQ0MsU0FBbkMsUUFBb0QsT0FBcEQ7QUFFQSxPQUFPQyxXQUFQLE1BQXdCLHlDQUF4QjtBQUVBLFNBQVNDLGFBQVQsUUFBOEIsMkNBQTlCO0FBRUEsU0FBU0MsUUFBVCxRQUF5QixVQUF6QjtBQUNBLFNBQVNDLGNBQVQsUUFBK0IsYUFBL0I7QUFFQSxPQUFPQyxLQUFQLE1BQWtCLGlCQUFsQjtBQUNBLE9BQU9DLE1BQVAsTUFBbUIsaUJBQW5CO0FBQ0EsU0FBU0MsY0FBVCxRQUErQix3QkFBL0I7QUFFQSxTQUNFQyxlQURGLEVBRUVDLFdBRkYsRUFHRUMsMEJBSEYsRUFJRUMsZ0JBSkYsRUFLRUMsdUJBTEYsRUFNRUMsU0FORixRQU9PLFlBUFA7QUFTQSxNQUFNQyxJQUFJLEdBQUdULEtBQUssQ0FBQ1UsT0FBbkI7QUFFQSxPQUFPQyxVQUFQLE1BQXVCLG9DQUF2QjtB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SyxFQUFFekUsU0FBUyxDQUFDUyxRQUFEO0FBQWxCLFdBREEsR0FFQSxFQUZKO0FBSEssU0FQRDtBQWNOK0UsUUFBQUEsUUFBUSxFQUFFdkUsQ0FBQyxDQUFDOEQsWUFkTjtBQWVOVSxRQUFBQSxNQUFNLEVBQUU7QUFBRUMsVUFBQUEsV0FBVyxFQUFFO0FBQWYsU0FmRjtBQWdCTkMsUUFBQUEsZUFBZSxFQUFFLEdBaEJYO0FBaUJOOUUsUUFBQUEsV0FBVyxFQUFFSixRQUFRLElBQUlJLFdBakJuQjtBQWtCTkUsUUFBQUEsTUFBTSxFQUFFTixRQUFRLElBQUlNO0FBbEJkO0FBNUJWLE1BRkYsQ0FMRjtBQTBERCxHQTNEYSxFQTJEWCxDQUFDTixRQUFELEVBQVdJLFdBQVgsRUFBd0JFLE1BQXhCLEVBQWdDSixRQUFoQyxFQUEwQ00sQ0FBQyxDQUFDOEQsWUFBNUMsQ0EzRFcsQ0FBZDtBQTRERCxDQXBNRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyB1c2VTdGF0ZSwgdXNlTWVtbywgdXNlRWZmZWN0IH0gZnJvbSBcInJlYWN0XCI7XHJcblxyXG5pbXBvcnQgS1JJbmRpY2F0b3IgZnJvbSBcIi9AaWFuYWx5dGljcy9kNGQvY29tcG9uZW50cy9LUkluZGljYXRvclwiO1xyXG5cclxuaW1wb3J0IHsgdXNlU3RhdGVWYWx1ZSB9IGZyb20gXCIvQGlhbmFseXRpY3MvZDRkL2NvbXBvbmVudHMvU3RhdGVQcm92aWRlclwiO1xyXG5cclxuaW1wb3J0IHsgcGFyc2VJU08gfSBmcm9tIFwiZGF0ZS1mbnNcIjtcclxuaW1wb3J0IHsgdXRjVG9ab25lZFRpbWUgfSBmcm9tIFwiZGF0ZS1mbnMtdHpcIjtcclxuXHJcbmltcG9ydCBYUGxvdCBmcm9tIFwicmVhY3QtcGxvdGx5LmpzXCI7XHJcbmltcG9ydCBzdHlsZWQgZnJvbSBcIkBlbW90aW9uL3N0eWxlZFwiO1xyXG5pbXBvcnQgeyBwbG90bHlEZWZhdWx0cyB9IGZyb20gXCIvQGlhbmFseXRpY3MvZDRkL3RoZW1lXCI7XHJcblxyXG5pbXBvcnQge1xyXG4gIG1ha2VBbm5vdGF0aW9ucyxcclxuICB0cmFjZUNvbG9ycyxcclxuICB3aWR0aE9mTWVhbldpbmRvd0luU2Vjb25kcyxcclxuICBhbGxQbG90bHlCdXR0b25zLFxyXG4gIHRvZ2dsZUV2ZW50Q3JlYXRpb25JY29uLFxyXG4gIGF1dG9yYW5nZSxcclxufSBmcm9tIFwiLi9wbG90ZnVuc1wiO1xyXG5cclxuY29uc3QgUGxvdCA9IFhQbG90LmRlZmF1bHQ7XHJcblxyXG5pbXBvcnQgU3lzdGVtYUFQSSBmcm9tIFwiZ29vZzppby5pYW5hbHl0aWNzLmQ0ZC5hcGkuc3lzdGVtYVwiO1xyXG5pbXBvcnQgVHJlbmRBUEkgZnJvbSBcImdvb2c6aW8uaWFuYWx5dGljcy5kNGQuYXBpLnRyZW5kXCI7XHJcbmltcG9ydCBVbml0c0FQSSBmcm9tIFwiZ29vZzppby5pYW5hbHl0aWNzLmQ0ZC5hcGkudW5pdHNcIjtcclxuXHJcbmltcG9ydCB7IENpcmN1bGFyUHJvZ3Jlc3MgfSBmcm9tIFwiQG1hdGVyaWFsLXVpL2NvcmVcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IFRpbWVTZXJpZXNQbG90ID0gZnVuY3Rpb24gKHByb3BzKSB7XHJcbiAgY29uc3QgW3Bsb3REYXRhLCBzZXRQbG90RGF0YV0gPSB1c2VTdGF0ZSh7fSk7XHJcblxyXG4gIGNvbnN0IFtmZXRjaGluZywgc2V0RmV0Y2hpbmddID0gdXNlU3RhdGUoZmFsc2UpO1xyXG5cclxuICBjb25zdCBbYW5ub3RhdGlvbnMsIHNldEFubm90YXRpb25zXSA9IHVzZVN0YXRlKFtdKTtcclxuICBjb25zdCBbc2hhcGVzLCBzZXRTaGFwZXNdID0gdXNlU3RhdGUoW10pO1xyXG5cclxuICBjb25zdCBbcywgZGlzcGF0Y2hdID0gdXNlU3RhdGVWYWx1ZSgpO1xyXG5cclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgbGV0IFtldmVudEFubm90YXRpb25zLCBldmVudFNoYXBlc10gPSBtYWtlQW5ub3RhdGlvbnMocHJvcHMudWlkcywgcyk7XHJcblxyXG4gICAgc2V0QW5ub3RhdGlvbnMoZXZlbnRBbm5vdGF0aW9ucyk7XHJcbiAgICBzZXRTaGFwZXMoZXZlbnRTaGFwZXMpO1xyXG4gIH0sIFtcclxuICAgIHByb3BzLnVpZHMsXHJcbiAgICBwcm9wcy5mcm9tLFxyXG4gICAgcHJvcHMudG8sXHJcbiAgICBzLmV2ZW50cyxcclxuICAgIHMudmlzaWJsZUV2ZW50cyxcclxuICAgIHMucGlubmVkRXZlbnRzLFxyXG4gIF0pO1xyXG5cclxuICBmdW5jdGlvbiB1cGRhdGVDdXN0b21SYW5nZShuZXdSYW5nZSkge1xyXG4gICAgZnVuY3Rpb24gY29ycmVjdFBsb3RseVRpbWVzdGFtcChwbG90bHlfc3RhbXApIHtcclxuICAgICAgcmV0dXJuIHBsb3RseV9zdGFtcFxyXG4gICAgICAgID8gcGxvdGx5X3N0YW1wLnNsaWNlKDAsIDEwKSArIFwiVFwiICsgcGxvdGx5X3N0YW1wLnNsaWNlKDExKVxyXG4gICAgICAgIDogXCJcIjtcclxuICAgIH1cclxuXHJcbiAgICBkaXNwYXRjaCh7XHJcbiAgICAgIHR5cGU6IFwiUFJFU0VMRUNUX1RJTUVfUkFOR0VcIixcclxuICAgICAgcGF5bG9hZDogbmV3UmFuZ2UubWFwKGNvcnJlY3RQbG90bHlUaW1lc3RhbXApLm1hcChwYXJzZUlTTyksXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHNlbGVjdFRpbWVGcm9tUGxvdCgpIHtcclxuICAgIGRpc3BhdGNoKHsgdHlwZTogXCJTV0lUQ0hfVE9fUFJFU0VMRUNURURfVElNRV9SQU5HRVwiIH0pO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gc2V0RGF0YShqc29uRGF0YSwgdWlkKSB7XHJcbiAgICBpZiAoIWpzb25EYXRhIHx8ICFqc29uRGF0YS5oYXNPd25Qcm9wZXJ0eShcInRpbWVcIikpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGRhdGFDb3VudCA9IGpzb25EYXRhLnRpbWUubGVuZ3RoO1xyXG5cclxuICAgIC8vIGxvY2FsaXplIHRpbWVcclxuICAgIGNvbnN0IHRpbWVab25lID0gXCJFdXJvcGUvQmVybGluXCI7IC8qIFRPRE86IG1ha2UgdGltZXpvbmUgY29uZmlndXJhYmxlLiAgKi9cclxuICAgIGNvbnN0IGxvY2FsaXplZFRpbWUgPSBqc29uRGF0YS50aW1lLm1hcCgodHMpID0+XHJcbiAgICAgIHV0Y1RvWm9uZWRUaW1lKHBhcnNlSVNPKHRzKSwgdGltZVpvbmUpXHJcbiAgICApO1xyXG5cclxuICAgIGRlbGV0ZSBqc29uRGF0YS50aW1lO1xyXG5cclxuICAgIC8vIHRyYW5zZm9ybSB1bml0c1xyXG4gICAgY29uc3QgZGlzcGxheVVuaXQgPSBTeXN0ZW1hQVBJLmRpc3BsYXlVbml0KHVpZCk7XHJcbiAgICBjb25zdCB0cmFuc2Zvcm1lZFZhbHVlcyA9IE9iamVjdC52YWx1ZXMoanNvbkRhdGEpLm1hcCgodmFsdWVzKSA9PlxyXG4gICAgICBVbml0c0FQSS50cmFuc2Zvcm0odmFsdWVzLCBkaXNwbGF5VW5pdClcclxuICAgICk7XHJcblxyXG4gICAgbGV0IG5ld1RyYWNlcyA9IHt9O1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmFuc2Zvcm1lZFZhbHVlcy5sZW5ndGg7ICsraSkge1xyXG4gICAgICBuZXdUcmFjZXNbdWlkICsgaV0gPSB7XHJcbiAgICAgICAgeDogbG9jYWxpemVkVGltZSxcclxuICAgICAgICB5OiB0cmFuc2Zvcm1lZFZhbHVlc1tpXSxcclxuICAgICAgICB0eXBlOiBcInNjYXR0ZXJcIixcclxuICAgICAgICBmaWxsOiBcInRvemVyb3lcIixcclxuICAgICAgICBuYW1lOiBgJHtTeXN0ZW1hQVBJLnBsb3RUaXRsZSh1aWQpfSAke2kgPiAwID8gaSA6IFwiXCJ9YCxcclxuICAgICAgICBmaWxsY29sb3I6XHJcbiAgICAgICAgICB0cmFjZUNvbG9yc1socHJvcHMudWlkcy5pbmRleE9mKHVpZCkgKyBpKSAlIHRyYWNlQ29sb3JzLmxlbmd0aF0gK1xyXG4gICAgICAgICAgXCIyMlwiLFxyXG4gICAgICAgIGxpbmU6IHtcclxuICAgICAgICAgIGNvbG9yOlxyXG4gICAgICAgICAgICB0cmFjZUNvbG9yc1socHJvcHMudWlkcy5pbmRleE9mKHVpZCkgKyBpKSAlIHRyYWNlQ29sb3JzLmxlbmd0aF0sXHJcbiAgICAgICAgfSxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRQbG90RGF0YShmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICByZXR1cm4geyAuLi5kYXRhLCAuLi5uZXdUcmFjZXMgfTtcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnNvbGUuZGVidWcoXHJcbiAgICAgIFwicmVhZDogXCIsXHJcbiAgICAgIE9iamVjdC5rZXlzKGpzb25EYXRhKS5sZW5ndGggLSAxLCAvLyAndGltZScgKyBvbmUgbnVtZXJpY2FsIGVudHJ5IGZvciBlYWNoIHRpbWVzZXJpZXMuXHJcbiAgICAgIFwiIHggXCIsXHJcbiAgICAgIGpzb25EYXRhLnRpbWUubGVuZ3RoLFxyXG4gICAgICBcImRhdGEgcG9pbnRzLlwiXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gZmV0Y2hEYXRhKCkge1xyXG4gICAgc2V0RmV0Y2hpbmcodHJ1ZSk7XHJcbiAgICBzZXRQbG90RGF0YSh7fSk7XHJcblxyXG4gICAgZm9yIChjb25zdCB1aWQgb2YgcHJvcHMudWlkcykge1xyXG4gICAgICBjb25zb2xlLmRlYnVnKFxyXG4gICAgICAgIGBmZXRjaGluZyBuZXcgZGF0YSBmb3IgJHt1aWR9IGluIFske3Byb3BzLmZyb219XHJcbiAgICAgICAgLCAke3Byb3BzLnRvfV0uYFxyXG4gICAgICApO1xyXG5cclxuICAgICAgVHJlbmRBUEkuZ2V0VHJlbmQoXHJcbiAgICAgICAgdWlkLFxyXG4gICAgICAgIHByb3BzLmZyb20sXHJcbiAgICAgICAgcHJvcHMudG8sXHJcbiAgICAgICAgd2lkdGhPZk1lYW5XaW5kb3dJblNlY29uZHMocHJvcHMuZnJvbSwgcHJvcHMudG8pLFxyXG4gICAgICAgIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICBzZXREYXRhKGRhdGEsIHVpZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIHNldEZldGNoaW5nKGZhbHNlKTtcclxuXHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xyXG4gICAgICBzZXRQbG90RGF0YSh7fSk7XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgdXNlRWZmZWN0KGZldGNoRGF0YSwgW3Byb3BzLnVpZHMsIHByb3BzLmZyb20sIHByb3BzLnRvXSk7XHJcblxyXG4gIGZ1bmN0aW9uIHRvZ2dsZUV2ZW50Q3JlYXRpb24oZnJvbSwgdG8pIHtcclxuICAgIGRpc3BhdGNoKHtcclxuICAgICAgdHlwZTogXCJPUEVOX0VWRU5UX0NSRUFUT1JcIixcclxuICAgICAgcGF5bG9hZDoge1xyXG4gICAgICAgIGZyb206IG5ldyBEYXRlKGZyb20pLFxyXG4gICAgICAgIHRvOiBuZXcgRGF0ZSh0byksXHJcbiAgICAgICAgdWlkczogcHJvcHMudWlkcyxcclxuICAgICAgfSxcclxuXHJcbiAgICAgIGRpc3BhdGNoOiBkaXNwYXRjaCxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHVzZU1lbW8oKCkgPT4ge1xyXG4gICAgcmV0dXJuIGZldGNoaW5nID8gKFxyXG4gICAgICA8ZGl2IHN0eWxlPXt7IHdpZHRoOiBcIjYwdndcIiwgaGVpZ2h0OiBcIjMwMHB4XCIgfX0+XHJcbiAgICAgICAgPENpcmN1bGFyUHJvZ3Jlc3MgLz5cclxuICAgICAgPC9kaXY+XHJcbiAgICApIDogKFxyXG4gICAgICA8PlxyXG4gICAgICAgIDxLUkluZGljYXRvciBkYXRhPXtPYmplY3QudmFsdWVzKHBsb3REYXRhKX0gLz5cclxuICAgICAgICA8UGxvdFxyXG4gICAgICAgICAgc3R5bGU9e3tcclxuICAgICAgICAgICAgd2lkdGg6IFwiNjB2d1wiLFxyXG4gICAgICAgICAgICBoZWlnaHQ6IE9iamVjdC5rZXlzKHBsb3REYXRhKS5sZW5ndGggPD0gMSA/IFwiMzAwcHhcIiA6IFwiNjAwcHhcIixcclxuICAgICAgICAgIH19XHJcbiAgICAgICAgICBkYXRhPXtPYmplY3QudmFsdWVzKHBsb3REYXRhKX1cclxuICAgICAgICAgIG9uU2VsZWN0ZWQ9eyhlKSA9PlxyXG4gICAgICAgICAgICBlICYmIGUucmFuZ2UgJiYgdG9nZ2xlRXZlbnRDcmVhdGlvbihlLnJhbmdlLnhbMF0sIGUucmFuZ2UueFsxXSlcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIG9uVXBkYXRlPXsoZCkgPT4gdXBkYXRlQ3VzdG9tUmFuZ2UoZC5sYXlvdXQueGF4aXMucmFuZ2UpfVxyXG4gICAgICAgICAgY29uZmlnPXt7XHJcbiAgICAgICAgICAgIG1vZGVCYXJCdXR0b25zVG9SZW1vdmU6IGFsbFBsb3RseUJ1dHRvbnMsXHJcbiAgICAgICAgICAgIG1vZGVCYXJCdXR0b25zVG9BZGQ6IFtcclxuICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBuYW1lOiBzLnBsb3REcmFnTW9kZSA9PT0gXCJ6b29tXCIgPyBcIkNyZWF0ZSBFdmVudFwiIDogXCJab29tXCIsXHJcbiAgICAgICAgICAgICAgICBpY29uOiB0b2dnbGVFdmVudENyZWF0aW9uSWNvbixcclxuICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogXCJ1cFwiLFxyXG4gICAgICAgICAgICAgICAgY2xpY2s6ICgpID0+XHJcbiAgICAgICAgICAgICAgICAgIGRpc3BhdGNoKHsgdHlwZTogXCJUT0dHTEVfUExPVF9FVkVOVF9DUkVBVElPTl9NT0RFXCIgfSksXHJcbiAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBuYW1lOiBcIlVzZSBUaGlzIFRpbWUgRnJhbWVcIixcclxuICAgICAgICAgICAgICAgIC8vIGljb246IHBpY2sgb25lLFxyXG4gICAgICAgICAgICAgICAgZGlyZWN0aW9uOiBcInVwXCIsXHJcbiAgICAgICAgICAgICAgICBjbGljazogc2VsZWN0VGltZUZyb21QbG90LFxyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICB9fVxyXG4gICAgICAgICAgbGF5b3V0PXt7XHJcbiAgICAgICAgICAgIC4uLnBsb3RseURlZmF1bHRzLFxyXG4gICAgICAgICAgICBhdXRvc2l6ZTogdHJ1ZSxcclxuICAgICAgICAgICAgdGl0bGU6IHtcclxuICAgICAgICAgICAgICAuLi5wbG90bHlEZWZhdWx0cy50aXRsZV9kZWZhdWx0cyxcclxuICAgICAgICAgICAgICB0ZXh0OiBgPGI+JHtTeXN0ZW1hQVBJLnBsb3RUaXRsZShwcm9wcy51aWRzWzBdKX08L2I+YCxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgeWF4aXM6IHtcclxuICAgICAgICAgICAgICAuLi5wbG90bHlEZWZhdWx0cy55YXhpcyxcclxuICAgICAgICAgICAgICB0aXRsZTogYFske1N5c3RlbWFBUEkuZGlzcGxheVVuaXQocHJvcHMudWlkc1swXSl9XWAsXHJcbiAgICAgICAgICAgICAgLi4uKHBsb3REYXRhICYmIHBsb3REYXRhICE9PSB7fVxyXG4gICAgICAgICAgICAgICAgPyB7IHJhbmdlOiBhdXRvcmFuZ2UocGxvdERhdGEpIH1cclxuICAgICAgICAgICAgICAgIDoge30pLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBkcmFnbW9kZTogcy5wbG90RHJhZ01vZGUsXHJcbiAgICAgICAgICAgIGxlZ2VuZDogeyBvcmllbnRhdGlvbjogXCJoXCIgfSxcclxuICAgICAgICAgICAgc2VsZWN0ZGlyZWN0aW9uOiBcImhcIixcclxuICAgICAgICAgICAgYW5ub3RhdGlvbnM6IHBsb3REYXRhICYmIGFubm90YXRpb25zLFxyXG4gICAgICAgICAgICBzaGFwZXM6IHBsb3REYXRhICYmIHNoYXBlcyxcclxuICAgICAgICAgIH19XHJcbiAgICAgICAgLz5cclxuICAgICAgPC8+XHJcbiAgICApO1xyXG4gIH0sIFtwbG90RGF0YSwgYW5ub3RhdGlvbnMsIHNoYXBlcywgZmV0Y2hpbmcsIHMucGxvdERyYWdNb2RlXSk7XHJcbn07XHJcbiJdfQ==