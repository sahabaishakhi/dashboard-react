import { buildTree, enrichNodesWithPlots } from "goog:io.ianalytics.d4d.api.systema";
import SystemaAPI from "goog:io.ianalytics.d4d.api.systema";
import { groupEventsByID } from "goog:io.ianalytics.d4d.api.event";
import EventAPI from "goog:io.ianalytics.d4d.api.event";
import LabelAPI from "goog:io.ianalytics.d4d.api.label";
import CommentAPI from "goog:io.ianalytics.d4d.api.comment";
import { parseISO, isValid } from "date-fns";

function midway(fromDate, toDate) {
  if (isValid(toDate)) {
    return new Date(fromDate.getTime() + 0.5 * (toDate - fromDate));
  } else {
    return fromDate;
  }
}

function moveDateBy(dateFrom, delta_millis) {
  return new Date(dateFrom.getTime() + delta_millis);
} // Use as filter predicate to get unique elements in array


function onlyUnique(value, index, self) {
  return self.indexOf(value) === index;
} // View reducer


function updateMainView(newView) {
  return {
    mainView: newView
  };
} // Main reducer


export default function reducer(state, action) {
  console.log(buildTree(action.payload));

  switch (action.type) {
    /* SYSTEMA */
    case "GET_SYSTEMA_DESCRIPTION":
      SystemaAPI.getDescription(function (payload) {
        // console.log("case1")
        action.dispatch({
          type: "MERGE_SYSTEMA_DESCRIPTION",
          payload
        });
      });
      return state;

    case "MERGE_SYSTEMA_DESCRIPTION":
      // console.log(action)
      return { ...state,
        systema: buildTree(action.payload),
        systemaNodes: enrichNodesWithPlots(action.payload)
      };

    /* TIME RANGE SELECTOR */

    case "SELECT_TIME_RANGE":
      // console.log(action)
      if (action.payload && action.payload.from && isValid(action.payload.from) && action.payload.to && isValid(action.payload.to)) {
        // console.log(action)
        localStorage.globalFrom = action.payload.from.toISOString();
        localStorage.globalTo = action.payload.to.toISOString();
        action.dispatch({
          type: "UPDATE_FILTERED_EVENTS",
          payload: { ...state,
            timeSelection: action.payload,
            dispatch: action.dispatch
          }
        });
        return { ...state,
          timeSelection: action.payload // ...updateMainView(state.mainView),

        };
      } else {
        return state;
      }

    case "SELECT_TIME_RANGE_FROM_EVENT":
      let eventId = action.payload;
      const {
        start,
        end
      } = state.events[eventId];
      const {
        from,
        to
      } = state.timeSelection;
      let eventTime = midway(parseISO(start), parseISO(end));
      let currentTime = midway(from, to);
      let deltaTime = eventTime - currentTime;
      return { ...state,
        timeSelection: {
          from: moveDateBy(state.timeSelection.from, deltaTime),
          to: moveDateBy(state.timeSelection.to, deltaTime)
        }
      };

    case "PRESELECT_TIME_RANGE":
      return { ...state,
        timeUserSelection: action.payload
      };

    case "SWITCH_TO_PRESELECTED_TIME_RANGE":
      if (state.timeUserSelection && isValid(state.timeUserSelection[0]) && isValid(state.timeUserSelection[1])) {
        return { ...state,
          timeSelection: { ...state.timeSelection,
            from: state.timeUserSelection[0],
            to: state.timeUserSelection[1]
          },
          timeUserSelection: [null, null]
        };
      } else {
        console.warn("invalid dates in preselection -- won't switch");
        return state;
      }

    case "TOGGLE_PLOT_EVENT_CREATION_MODE":
      return { ...state,
        plotDragMode: state.plotDragMode === "zoom" ? "select" : "zoom"
      };

    case "TOGGLE_REFRESH":
      return { ...state,
        plotsAutoUpdate: !state.plotsAutoUpdate
      };

    /* MAIN VIEW */

    case "UPDATE_MAIN_VIEW":
      return { ...state,
        ...updateMainView(action.payload)
      };

    /*  EVENT */

    case "GET_ALL_EVENTS":
      EventAPI.getAllEvents(function (payload) {
        action.dispatch({
          type: "MERGE_ALL_EVENTS",
          payload,
          dispatch: action.dispatch
        });
      });
      return state;

    case "MERGE_ALL_EVENTS":
      action.dispatch({
        type: "UPDATE_FILTERED_EVENTS",
        payload: { ...state,
          events: groupEventsByID(action.payload)
        }
      });
      return { ...state
      };

    case "OPEN_EVENT_CREATOR":
      return { ...state,
        eventCreatorOpen: true,
        eventCreatorData: action.payload
      };

    case "CLOSE_EVENT_CREATOR":
      return { ...state,
        eventCreatorOpen: false
      };

    case "CREATE_EVENT":
      EventAPI.createEvent(action.payload, function (payload) {
        action.dispatch({
          type: "GET_EVENT",
          payload,
          dispatch: action.dispatch
        });
      });
      return state;

    case "GET_EVENT":
      EventAPI.getEvent(action.payload, function (payload) {
        action.dispatch({
          type: "MERGE_EVENT",
          payload,
          eventId: action.payload,
          dispatch: action.dispatch
        });
      });
      return state;

    case "MERGE_EVENT":
      let newEvents = { ...state.events
      };
      /* copying this so consumers receive updates */

      newEvents[action.payload[0]._id] = action.payload[0];
      action.dispatch({
        type: "UPDATE_FILTERED_EVENTS",
        payload: { ...state,
          events: newEvents
        }
      });
      return state;

    case "PIN_EVENT":
      return { ...state,
        // action.payload is an event object
        pinnedEvents: state.pinnedEvents.concat(action.payload._id)
      };

    case "UNPIN_EVENT":
      return { ...state,
        pinnedEvents: state.pinnedEvents.filter(eventId => eventId !== action.payload._id)
      };

    case "DELETE_EVENT":
      EventAPI.deleteEvent(action.payload, function (payload) {
        action.dispatch({
          type: "REMOVE_EVENT_FROM_STATE",
          payload: action.payload
        });
      });
      return state;

    case "UPDATE_EVENT":
      EventAPI.updateEvent(action.payload, payload => action.dispatch({
        type: "GET_EVENT",
        payload: payload,
        dispatch: action.dispatch
      }));
      return state;

    case "REMOVE_EVENT_FROM_STATE":
      let newEvents_ = { ...state.events
      };
      newPinnedEvents = state.pinnedEvents.filter(pinnedEvent => pinnedEvent._id !== action.payload);
      newVisibleEvents = state.visibleEvents.filter(event => event._id !== action.payload);
      /* copying this so consumers receive updates */

      delete newEvents_[action.payload];
      return { ...state,
        events: newEvents_,
        pinnedEvents: newPinnedEvents,
        visibleEvents: newVisibleEvents
      };

    case "COMBINE_PINNED_EVENTS":
      let pinnedEventObjects = state.pinnedEvents.map(id => state.events[id]);
      EventAPI.combineEvents(pinnedEventObjects);
      return state;
    // TODO

    /* LABEL */

    case "GET_ALL_LABELS":
      LabelAPI.getAllLabels(function (payload) {
        action.dispatch({
          type: "MERGE_ALL_LABELS",
          payload
        });
      });
      return state;

    case "MERGE_ALL_LABELS":
      let new_labels = action.payload.filter(new_label => !state.labels.find(state_label => state_label._id === new_label._id));
      return { ...state,
        labels: [...state.labels, ...new_labels]
      };

    case "CREATE_LABEL":
      LabelAPI.createLabel(action.payload, function (payload) {
        action.dispatch({
          type: "GET_LABEL",
          payload,
          dispatch: action.dispatch
        });
      });
      return state;

    case "GET_LABEL":
      LabelAPI.getLabel(action.payload, function (payload) {
        action.dispatch({
          type: "MERGE_LABEL",
          payload
        });
      });
      return state;

    case "MERGE_LABEL":
      return { ...state,
        labels: state.labels.concat(action.payload)
      };

    case "DELETE_LABEL":
      LabelAPI.deleteLabel(action.payload, function (payload) {
        action.dispatch({
          type: "REMOVE_LABEL_FROM_STATE",
          payload: action.payload
        });
      });
      return state;

    case "REMOVE_LABEL_FROM_STATE":
      return { ...state,
        labels: state.labels.filter(label => label._id !== action.payload)
      };

    case "GET_ALL_COMMENTS":
      CommentAPI.getAllComments(action.payload, function (payload) {
        action.dispatch({
          type: "SET_COMMENTS",
          payload
        });
      });
      return state;

    case "GET_EVENT_COMMENTS":
      CommentAPI.getEventComments(action.payload, function (payload) {
        action.dispatch({
          type: "SET_COMMENTS",
          payload
        });
      });
      return state;

    case "SET_COMMENTS":
      return { ...state,
        comments: action.payload
      };

    case "CREATE_COMMENT":
      CommentAPI.createComment(action.payload);
      return { ...state,
        comments: [...state.comments, action.payload]
      };

    case "MERGE_COMMENTS":
      return { ...state,
        comments: state.comments.concat(action.payload)
      };

    case "UPDATE_EXPANDED_SYSTEMA_NODES":
      return { ...state,
        expandedSystemaNodes: action.payload
      };

    case "UPDATE_SELECTED_SYSTEMA_NODES":
      return { ...state,
        selectedSystemaNodes: action.payload
      };

    case "EXPAND_ALL_SYSTEMA_NODES":
      return { ...state,
        expandedSystemaNodes: Object.keys(state.systemaNodes)
      };

    case "COLLAPSE_ALL_SYSTEMA_NODES":
      return { ...state,
        expandedSystemaNodes: []
      };

    case "OPEN_EVENT_DETAILS":
      return { ...state,
        eventDetailsOpen: true,
        eventDetailsEventUID: action.payload
      };

    case "CLOSE_EVENT_DETAILS":
      return { ...state,
        eventDetailsOpen: false
      };

    /* EVENT FILTER */

    case "UPDATE_FILTERED_EVENTS":
      /* This action is dispatched after every event filter action.
      `visibleEvents` object gets mutated here. */
      function isVisible(state, event) {
        // severity
        selectedSeverities = action.payload.eventFilter.selectedSeverities;
        excludedLabels = action.payload.eventFilter.excludedLabels;
        const severity = event.severity; // free text

        const freeText = action.payload.eventFilter.freeText;
        const matchesFreeText = freeText == "" || !freeText ? true : event.description ? event.description.toLowerCase().includes(freeText.toLowerCase()) : false; // label

        const excludedByLabel = excludedLabels.reduce((excluded, excludedLabel) => excluded || event.label.includes(excludedLabel), false); // event date or creation date

        const eventStart = parseISO(event.start);
        const eventEnd = parseISO(event.end);
        const selectionFrom = action.payload.timeSelection.from;
        const selectionTo = action.payload.timeSelection.to; // include events that have some overlap with the time selection
        // (can reach out left and/or right out of the selection)

        const excludedByTimeSelection = action.payload.eventFilter.onlySelectedTimeRange ? selectionFrom >= eventEnd || selectionTo <= eventStart : false; // creation date

        const createDate = parseISO(event.createDate);
        const excludedByCreateDate = action.payload.eventFilter.onlySelectedCreateTimeRange ? !(selectionFrom <= createDate && createDate <= selectionTo) : false;
        return selectedSeverities.includes(severity) && !excludedByLabel && matchesFreeText && !excludedByTimeSelection && !excludedByCreateDate;
      }

      const events = action.payload.events;
      const visibleEvents = events ? Object.values(events).filter(event => res = isVisible(state, event)) : [];
      return { ...state,
        timeSelection: action.payload.timeSelection,
        events: action.payload.events,
        eventFilter: action.payload.eventFilter,
        visibleEvents: visibleEvents
      };

    case "UPDATE_EVENT_FILTER_SEVERITIES":
      action.dispatch({
        type: "UPDATE_FILTERED_EVENTS",
        payload: { ...state,
          eventFilter: { ...state.eventFilter,
            selectedSeverities: action.payload
          }
        }
      });
      return state;

    case "UPDATE_EVENT_FILTER_LABELS":
      labelId = action.payload._id;
      isAlreadyExcluded = state.eventFilter.excludedLabels.includes(labelId);
      excludedLabels = isAlreadyExcluded ? excludedLabels.filter(excludedLabelId => labelId !== excludedLabelId) : [...state.eventFilter.excludedLabels, labelId];
      action.dispatch({
        type: "UPDATE_FILTERED_EVENTS",
        payload: { ...state,
          eventFilter: { ...state.eventFilter,
            excludedLabels: excludedLabels
          }
        }
      });
      return state;

    case "UPDATE_EVENT_FILTER_FREE_TEXT":
      action.dispatch({
        type: "UPDATE_FILTERED_EVENTS",
        payload: { ...state,
          eventFilter: { ...state.eventFilter,
            freeText: action.payload
          }
        }
      });
      return state;

    case "UPDATE_EVENT_FILTER_ONLY_SELECTED_TIME_RANGE":
      const onlySelectedTimeRange = state.eventFilter.onlySelectedTimeRange;
      const onlySelectedCreateTimeRange = state.eventFilter.onlySelectedCreateTimeRange;
      const dateType = action.payload;
      dateType === "event" ? action.dispatch({
        type: "UPDATE_FILTERED_EVENTS",
        payload: { ...state,
          eventFilter: { ...state.eventFilter,
            onlySelectedTimeRange: !onlySelectedTimeRange
          }
        }
      }) : action.dispatch({
        type: "UPDATE_FILTERED_EVENTS",
        payload: { ...state,
          eventFilter: { ...state.eventFilter,
            onlySelectedCreateTimeRange: !onlySelectedCreateTimeRange
          }
        }
      });
      return state;

    default:
      console.warn("reducer: cannot handle action with unknown type!", action);
      return state;
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2pzeC9AaWFuYWx5dGljcy9kNGQvYWN0aW9ucy9pbmRleC5qc3giXSwibmFtZXMiOlsiYnVpbGRUcmVlIiwiZW5yaWNoTm9kZXNXaXRoUGxvdHMiLCJTeXN0ZW1hQVBJIiwiZ3JvdXBFdmVudHNCeUlEIiwiRXZlbnRBUEkiLCJMYWJlbEFQSSIsIkNvbW1lbnRBUEkiLCJwYXJzZUlTTyIsImlzVmFsaWQiLCJtaWR3YXkiLCJmcm9tRGF0ZSIsInRvRGF0ZSIsIkRhdGUiLCJnZXRUaW1lIiwibW92ZURhdGVCeSIsImRhdGVGcm9tIiwiZGVsdGFfbWlsbGlzIiwib25seVVuaXF1ZSIsInZhbHVlIiwiaW5kZXgiLCJzZWxmIiwiaW5kZXhPZiIsInVwZGF0ZU1haW5WaWV3IiwibmV3VmlldyIsIm1haW5WaWV3IiwicmVkdWNlciIsInN0YXRlIiwiYWN0aW9uIiwiY29uc29sZSIsImxvZyIsInBheWxvYWQiLCJ0eXBlIiwiZ2V0RGVzY3JpcHRpb24iLCJkaXNwYXRjaCIsInN5c3RlbWEiLCJzeXN0ZW1hTm9kZXMiLCJmcm9tIiwidG8iLCJsb2NhbFN0b3JhZ2UiLCJnbG9iYWxGcm9tIiwidG9JU09TdHJpbmciLCJnbG9iYWxUbyIsInRpbWVTZWxlY3Rpb24iLCJldmVudElkIiwic3RhcnQiLCJlbmQiLCJldmVudHMiLCJldmVudFRpbWUiLCJjdXJyZW50VGltZSIsImRlbHRhVGltZSIsInRpbWVVc2VyU2VsZWN0aW9uIiwid2FybiIsInBsb3REcmFnTW9kZSIsInBsb3RzQXV0b1VwZGF0ZSIsImdldEFsbEV2ZW50cyIsImV2ZW50Q3JlYXRvck9wZW4iLCJldmVudENyZWF0b3JEYXRhIiwiY3JlYXRlRXZlbnQiLCJnZXRFdmVudCIsIm5ld0V2ZW50cyIsIl9pZCIsInBpbm5lZEV2ZW50cyIsImNvbmNhdCIsImZpbHRlciIsImRlbGV0ZUV2ZW50IiwidXBkYXRlRXZlbnQiLCJuZXdFdmVudHNfIiwibmV3UGlubmVkRXZlbnRzIiwicGlubmVkRXZlbnQiLCJuZXdWaXNpYmxlRXZlbnRzIiwidmlzaWJsZUV2ZW50cyIsImV2ZW50IiwicGlubmVkRXZlbnRPYmplY3RzIiwibWFwIiwiaWQiLCJjb21iaW5lRXZlbnRzIiwiZ2V0QWxsTGFiZWxzIiwibmV3X2xhYmVscyIsIm5ld19sYWJlbCIsImxhYmVscyIsImZpbmQiLCJzdGF0ZV9sYWJlbCIsImNyZWF0ZUxhYmVsIiwiZ2V0TGFiZWwiLCJkZWxldGVMYWJlbCIsImxhYmVsIiwiZ2V0QWxsQ29tbWVudHMiLCJnZXRFdmVudENvbW1lbnRzIiwiY29tbWVudHMiLCJjcmVhdGVDb21tZW50IiwiZXhwYW5kZWRTeXN0ZW1hTm9kZXMiLCJzZWxlY3RlZFN5c3RlbWFOb2RlcyIsIk9iamVjdCIsImtleXMiLCJldmVudERldGFpbHNPcGVuIiwiZXZlbnREZXRhaWxzRXZlbnRVSUQiLCJpc1Zpc2libGUiLCJzZWxlY3RlZFNldmVyaXRpZXMiLCJldmVudEZpbHRlciIsImV4Y2x1ZGVkTGFiZWxzIiwic2V2ZXJpdHkiLCJmcmVlVGV4dCIsIm1hdGNoZXNGcmVlVGV4dCIsImRlc2NyaXB0aW9uIiwidG9Mb3dlckNhc2UiLCJpbmNsdWRlcyIsImV4Y2x1ZGVkQnlMYWJlbCIsInJlZHVjZSIsImV4Y2x1ZGVkIiwiZXhjbHVkZWRMYWJlbCIsImV2ZW50U3RhcnQiLCJldmVudEVuZCIsInNlbGVjdGlvbkZyb20iLCJzZWxlY3Rpb25UbyIsImV4Y2x1ZGVkQnlUaW1lU2VsZWN0aW9uIiwib25seVNlbGVjdGVkVGltZVJhbmdlIiwiY3JlYXRlRGF0ZSIsImV4Y2x1ZGVkQnlDcmVhdGVEYXRlIiwib25seVNlbGVjdGVkQ3JlYXRlVGltZVJhbmdlIiwidmFsdWVzIiwicmVzIiwibGFiZWxJZCIsImlzQWxyZWFkeUV4Y2x1ZGVkIiwiZXhjbHVkZWRMYWJlbElkIiwiZGF0ZVR5cGUiXSwibWFwcGluZ3MiOiJBQUFBLFNBQ0VBLFNBREYsRUFFRUMsb0JBRkYsUUFHTyxvQ0FIUDtBQUlBLE9BQU9DLFVBQVAsTUFBdUIsb0NBQXZC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RkssT0FBaEIsQ0FESixHQVdJeEYsTUFBTSxDQUFDTSxRQUFQLENBQWdCO0FBQ2RGLFFBQUFBLElBQUksRUFBRSx3QkFEUTtBQUVkRCxRQUFBQSxPQUFPLEVBQUUsRUFDUCxHQUFHSixLQURJO0FBRVB3RSxVQUFBQSxXQUFXLEVBQUUsRUFDWCxHQUFHeEUsS0FBSyxDQUFDd0UsV0FERTtBQUVYb0IsWUFBQUEsMkJBQTJCLEVBQUUsQ0FBQ0E7QUFGbkI7QUFGTjtBQUZLLE9BQWhCLENBWEo7QUFxQkEsYUFBTzVGLEtBQVA7O0FBRUY7QUFDRUUsTUFBQUEsT0FBTyxDQUFDdUIsSUFBUixDQUFhLGtEQUFiLEVBQWlFeEIsTUFBakU7QUFDQSxhQUFPRCxLQUFQO0FBcGRKO0FBc2REIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBidWlsZFRyZWUsXHJcbiAgZW5yaWNoTm9kZXNXaXRoUGxvdHMsXHJcbn0gZnJvbSBcImdvb2c6aW8uaWFuYWx5dGljcy5kNGQuYXBpLnN5c3RlbWFcIjtcclxuaW1wb3J0IFN5c3RlbWFBUEkgZnJvbSBcImdvb2c6aW8uaWFuYWx5dGljcy5kNGQuYXBpLnN5c3RlbWFcIjtcclxuaW1wb3J0IHsgZ3JvdXBFdmVudHNCeUlEIH0gZnJvbSBcImdvb2c6aW8uaWFuYWx5dGljcy5kNGQuYXBpLmV2ZW50XCI7XHJcbmltcG9ydCBFdmVudEFQSSBmcm9tIFwiZ29vZzppby5pYW5hbHl0aWNzLmQ0ZC5hcGkuZXZlbnRcIjtcclxuaW1wb3J0IExhYmVsQVBJIGZyb20gXCJnb29nOmlvLmlhbmFseXRpY3MuZDRkLmFwaS5sYWJlbFwiO1xyXG5pbXBvcnQgQ29tbWVudEFQSSBmcm9tIFwiZ29vZzppby5pYW5hbHl0aWNzLmQ0ZC5hcGkuY29tbWVudFwiO1xyXG5pbXBvcnQgeyBwYXJzZUlTTywgaXNWYWxpZCB9IGZyb20gXCJkYXRlLWZuc1wiO1xyXG5cclxuZnVuY3Rpb24gbWlkd2F5KGZyb21EYXRlLCB0b0RhdGUpIHtcclxuICBpZiAoaXNWYWxpZCh0b0RhdGUpKSB7XHJcbiAgICByZXR1cm4gbmV3IERhdGUoZnJvbURhdGUuZ2V0VGltZSgpICsgMC41ICogKHRvRGF0ZSAtIGZyb21EYXRlKSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIHJldHVybiBmcm9tRGF0ZTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG1vdmVEYXRlQnkoZGF0ZUZyb20sIGRlbHRhX21pbGxpcykge1xyXG4gIHJldHVybiBuZXcgRGF0ZShkYXRlRnJvbS5nZXRUaW1lKCkgKyBkZWx0YV9taWxsaXMpO1xyXG59XHJcblxyXG4vLyBVc2UgYXMgZmlsdGVyIHByZWRpY2F0ZSB0byBnZXQgdW5pcXVlIGVsZW1lbnRzIGluIGFycmF5XHJcbmZ1bmN0aW9uIG9ubHlVbmlxdWUodmFsdWUsIGluZGV4LCBzZWxmKSB7XHJcbiAgcmV0dXJuIHNlbGYuaW5kZXhPZih2YWx1ZSkgPT09IGluZGV4O1xyXG59XHJcblxyXG4vLyBWaWV3IHJlZHVjZXJcclxuZnVuY3Rpb24gdXBkYXRlTWFpblZpZXcobmV3Vmlldykge1xyXG4gIHJldHVybiB7IG1haW5WaWV3OiBuZXdWaWV3IH07XHJcbn1cclxuLy8gTWFpbiByZWR1Y2VyXHJcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHJlZHVjZXIoc3RhdGUsIGFjdGlvbikge1xyXG4gIGNvbnNvbGUubG9nKGJ1aWxkVHJlZShhY3Rpb24ucGF5bG9hZCkpXHJcbiAgc3dpdGNoIChhY3Rpb24udHlwZSkge1xyXG4gICAgLyogU1lTVEVNQSAqL1xyXG4gICAgY2FzZSBcIkdFVF9TWVNURU1BX0RFU0NSSVBUSU9OXCI6XHJcbiAgICAgIFN5c3RlbWFBUEkuZ2V0RGVzY3JpcHRpb24oZnVuY3Rpb24gKHBheWxvYWQpIHtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZyhcImNhc2UxXCIpXHJcbiAgICAgICAgYWN0aW9uLmRpc3BhdGNoKHsgdHlwZTogXCJNRVJHRV9TWVNURU1BX0RFU0NSSVBUSU9OXCIsIHBheWxvYWQgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gc3RhdGU7XHJcbiAgICBjYXNlIFwiTUVSR0VfU1lTVEVNQV9ERVNDUklQVElPTlwiOlxyXG4gICAgICAvLyBjb25zb2xlLmxvZyhhY3Rpb24pXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgLi4uc3RhdGUsXHJcbiAgICAgICAgc3lzdGVtYTogYnVpbGRUcmVlKGFjdGlvbi5wYXlsb2FkKSxcclxuICAgICAgICBzeXN0ZW1hTm9kZXM6IGVucmljaE5vZGVzV2l0aFBsb3RzKGFjdGlvbi5wYXlsb2FkKSxcclxuICAgICAgfTtcclxuXHJcbiAgICAvKiBUSU1FIFJBTkdFIFNFTEVDVE9SICovXHJcbiAgICBjYXNlIFwiU0VMRUNUX1RJTUVfUkFOR0VcIjpcclxuICAgICAgLy8gY29uc29sZS5sb2coYWN0aW9uKVxyXG4gICAgICBpZiAoXHJcbiAgICAgICAgYWN0aW9uLnBheWxvYWQgJiZcclxuICAgICAgICBhY3Rpb24ucGF5bG9hZC5mcm9tICYmXHJcbiAgICAgICAgaXNWYWxpZChhY3Rpb24ucGF5bG9hZC5mcm9tKSAmJlxyXG4gICAgICAgIGFjdGlvbi5wYXlsb2FkLnRvICYmXHJcbiAgICAgICAgaXNWYWxpZChhY3Rpb24ucGF5bG9hZC50bylcclxuICAgICAgKSB7XHJcbiAgICAgICAgLy8gY29uc29sZS5sb2coYWN0aW9uKVxyXG4gICAgICAgIGxvY2FsU3RvcmFnZS5nbG9iYWxGcm9tID0gYWN0aW9uLnBheWxvYWQuZnJvbS50b0lTT1N0cmluZygpO1xyXG4gICAgICAgIGxvY2FsU3RvcmFnZS5nbG9iYWxUbyA9IGFjdGlvbi5wYXlsb2FkLnRvLnRvSVNPU3RyaW5nKCk7XHJcblxyXG4gICAgICAgIGFjdGlvbi5kaXNwYXRjaCh7XHJcbiAgICAgICAgICB0eXBlOiBcIlVQREFURV9GSUxURVJFRF9FVkVOVFNcIixcclxuICAgICAgICAgIHBheWxvYWQ6IHtcclxuICAgICAgICAgICAgLi4uc3RhdGUsXHJcbiAgICAgICAgICAgIHRpbWVTZWxlY3Rpb246IGFjdGlvbi5wYXlsb2FkLFxyXG4gICAgICAgICAgICBkaXNwYXRjaDogYWN0aW9uLmRpc3BhdGNoLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIC4uLnN0YXRlLFxyXG4gICAgICAgICAgdGltZVNlbGVjdGlvbjogYWN0aW9uLnBheWxvYWQsXHJcbiAgICAgICAgICAvLyAuLi51cGRhdGVNYWluVmlldyhzdGF0ZS5tYWluVmlldyksXHJcbiAgICAgICAgfTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gc3RhdGU7XHJcbiAgICAgIH1cclxuXHJcbiAgICBjYXNlIFwiU0VMRUNUX1RJTUVfUkFOR0VfRlJPTV9FVkVOVFwiOlxyXG4gICAgICBsZXQgZXZlbnRJZCA9IGFjdGlvbi5wYXlsb2FkO1xyXG4gICAgICBjb25zdCB7IHN0YXJ0LCBlbmQgfSA9IHN0YXRlLmV2ZW50c1tldmVudElkXTtcclxuICAgICAgY29uc3QgeyBmcm9tLCB0byB9ID0gc3RhdGUudGltZVNlbGVjdGlvbjtcclxuICAgICAgbGV0IGV2ZW50VGltZSA9IG1pZHdheShwYXJzZUlTTyhzdGFydCksIHBhcnNlSVNPKGVuZCkpO1xyXG4gICAgICBsZXQgY3VycmVudFRpbWUgPSBtaWR3YXkoZnJvbSwgdG8pO1xyXG5cclxuICAgICAgbGV0IGRlbHRhVGltZSA9IGV2ZW50VGltZSAtIGN1cnJlbnRUaW1lO1xyXG5cclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICAuLi5zdGF0ZSxcclxuICAgICAgICB0aW1lU2VsZWN0aW9uOiB7XHJcbiAgICAgICAgICBmcm9tOiBtb3ZlRGF0ZUJ5KHN0YXRlLnRpbWVTZWxlY3Rpb24uZnJvbSwgZGVsdGFUaW1lKSxcclxuICAgICAgICAgIHRvOiBtb3ZlRGF0ZUJ5KHN0YXRlLnRpbWVTZWxlY3Rpb24udG8sIGRlbHRhVGltZSksXHJcbiAgICAgICAgfSxcclxuICAgICAgfTtcclxuXHJcbiAgICBjYXNlIFwiUFJFU0VMRUNUX1RJTUVfUkFOR0VcIjpcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICAuLi5zdGF0ZSxcclxuICAgICAgICB0aW1lVXNlclNlbGVjdGlvbjogYWN0aW9uLnBheWxvYWQsXHJcbiAgICAgIH07XHJcbiAgICBjYXNlIFwiU1dJVENIX1RPX1BSRVNFTEVDVEVEX1RJTUVfUkFOR0VcIjpcclxuICAgICAgaWYgKFxyXG4gICAgICAgIHN0YXRlLnRpbWVVc2VyU2VsZWN0aW9uICYmXHJcbiAgICAgICAgaXNWYWxpZChzdGF0ZS50aW1lVXNlclNlbGVjdGlvblswXSkgJiZcclxuICAgICAgICBpc1ZhbGlkKHN0YXRlLnRpbWVVc2VyU2VsZWN0aW9uWzFdKVxyXG4gICAgICApIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgLi4uc3RhdGUsXHJcbiAgICAgICAgICB0aW1lU2VsZWN0aW9uOiB7XHJcbiAgICAgICAgICAgIC4uLnN0YXRlLnRpbWVTZWxlY3Rpb24sXHJcbiAgICAgICAgICAgIGZyb206IHN0YXRlLnRpbWVVc2VyU2VsZWN0aW9uWzBdLFxyXG4gICAgICAgICAgICB0bzogc3RhdGUudGltZVVzZXJTZWxlY3Rpb25bMV0sXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgdGltZVVzZXJTZWxlY3Rpb246IFtudWxsLCBudWxsXSxcclxuICAgICAgICB9O1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnNvbGUud2FybihcImludmFsaWQgZGF0ZXMgaW4gcHJlc2VsZWN0aW9uIC0tIHdvbid0IHN3aXRjaFwiKTtcclxuICAgICAgICByZXR1cm4gc3RhdGU7XHJcbiAgICAgIH1cclxuXHJcbiAgICBjYXNlIFwiVE9HR0xFX1BMT1RfRVZFTlRfQ1JFQVRJT05fTU9ERVwiOlxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIC4uLnN0YXRlLFxyXG4gICAgICAgIHBsb3REcmFnTW9kZTogc3RhdGUucGxvdERyYWdNb2RlID09PSBcInpvb21cIiA/IFwic2VsZWN0XCIgOiBcInpvb21cIixcclxuICAgICAgfTtcclxuXHJcbiAgICBjYXNlIFwiVE9HR0xFX1JFRlJFU0hcIjpcclxuICAgICAgcmV0dXJuIHsgLi4uc3RhdGUsIHBsb3RzQXV0b1VwZGF0ZTogIXN0YXRlLnBsb3RzQXV0b1VwZGF0ZSB9O1xyXG5cclxuICAgIC8qIE1BSU4gVklFVyAqL1xyXG4gICAgY2FzZSBcIlVQREFURV9NQUlOX1ZJRVdcIjpcclxuICAgICAgcmV0dXJuIHsgLi4uc3RhdGUsIC4uLnVwZGF0ZU1haW5WaWV3KGFjdGlvbi5wYXlsb2FkKSB9O1xyXG5cclxuICAgIC8qICBFVkVOVCAqL1xyXG4gICAgY2FzZSBcIkdFVF9BTExfRVZFTlRTXCI6XHJcbiAgICAgIEV2ZW50QVBJLmdldEFsbEV2ZW50cyhmdW5jdGlvbiAocGF5bG9hZCkge1xyXG4gICAgICAgIGFjdGlvbi5kaXNwYXRjaCh7XHJcbiAgICAgICAgICB0eXBlOiBcIk1FUkdFX0FMTF9FVkVOVFNcIixcclxuICAgICAgICAgIHBheWxvYWQsXHJcbiAgICAgICAgICBkaXNwYXRjaDogYWN0aW9uLmRpc3BhdGNoLFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIHN0YXRlO1xyXG4gICAgY2FzZSBcIk1FUkdFX0FMTF9FVkVOVFNcIjpcclxuICAgICAgYWN0aW9uLmRpc3BhdGNoKHtcclxuICAgICAgICB0eXBlOiBcIlVQREFURV9GSUxURVJFRF9FVkVOVFNcIixcclxuICAgICAgICBwYXlsb2FkOiB7IC4uLnN0YXRlLCBldmVudHM6IGdyb3VwRXZlbnRzQnlJRChhY3Rpb24ucGF5bG9hZCkgfSxcclxuICAgICAgfSk7XHJcbiAgICAgIHJldHVybiB7IC4uLnN0YXRlIH07XHJcbiAgICBjYXNlIFwiT1BFTl9FVkVOVF9DUkVBVE9SXCI6XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgLi4uc3RhdGUsXHJcbiAgICAgICAgZXZlbnRDcmVhdG9yT3BlbjogdHJ1ZSxcclxuICAgICAgICBldmVudENyZWF0b3JEYXRhOiBhY3Rpb24ucGF5bG9hZCxcclxuICAgICAgfTtcclxuICAgIGNhc2UgXCJDTE9TRV9FVkVOVF9DUkVBVE9SXCI6XHJcbiAgICAgIHJldHVybiB7IC4uLnN0YXRlLCBldmVudENyZWF0b3JPcGVuOiBmYWxzZSB9O1xyXG4gICAgY2FzZSBcIkNSRUFURV9FVkVOVFwiOlxyXG4gICAgICBFdmVudEFQSS5jcmVhdGVFdmVudChhY3Rpb24ucGF5bG9hZCwgZnVuY3Rpb24gKHBheWxvYWQpIHtcclxuICAgICAgICBhY3Rpb24uZGlzcGF0Y2goe1xyXG4gICAgICAgICAgdHlwZTogXCJHRVRfRVZFTlRcIixcclxuICAgICAgICAgIHBheWxvYWQsXHJcbiAgICAgICAgICBkaXNwYXRjaDogYWN0aW9uLmRpc3BhdGNoLFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIHN0YXRlO1xyXG4gICAgY2FzZSBcIkdFVF9FVkVOVFwiOlxyXG4gICAgICBFdmVudEFQSS5nZXRFdmVudChhY3Rpb24ucGF5bG9hZCwgZnVuY3Rpb24gKHBheWxvYWQpIHtcclxuICAgICAgICBhY3Rpb24uZGlzcGF0Y2goe1xyXG4gICAgICAgICAgdHlwZTogXCJNRVJHRV9FVkVOVFwiLFxyXG4gICAgICAgICAgcGF5bG9hZCxcclxuICAgICAgICAgIGV2ZW50SWQ6IGFjdGlvbi5wYXlsb2FkLFxyXG4gICAgICAgICAgZGlzcGF0Y2g6IGFjdGlvbi5kaXNwYXRjaCxcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICAgIHJldHVybiBzdGF0ZTtcclxuICAgIGNhc2UgXCJNRVJHRV9FVkVOVFwiOlxyXG4gICAgICBsZXQgbmV3RXZlbnRzID0ge1xyXG4gICAgICAgIC4uLnN0YXRlLmV2ZW50cyxcclxuICAgICAgfTsgLyogY29weWluZyB0aGlzIHNvIGNvbnN1bWVycyByZWNlaXZlIHVwZGF0ZXMgKi9cclxuICAgICAgbmV3RXZlbnRzW2FjdGlvbi5wYXlsb2FkWzBdLl9pZF0gPSBhY3Rpb24ucGF5bG9hZFswXTtcclxuXHJcbiAgICAgIGFjdGlvbi5kaXNwYXRjaCh7XHJcbiAgICAgICAgdHlwZTogXCJVUERBVEVfRklMVEVSRURfRVZFTlRTXCIsXHJcbiAgICAgICAgcGF5bG9hZDogeyAuLi5zdGF0ZSwgZXZlbnRzOiBuZXdFdmVudHMgfSxcclxuICAgICAgfSk7XHJcbiAgICAgIHJldHVybiBzdGF0ZTtcclxuXHJcbiAgICBjYXNlIFwiUElOX0VWRU5UXCI6XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgLi4uc3RhdGUsXHJcbiAgICAgICAgLy8gYWN0aW9uLnBheWxvYWQgaXMgYW4gZXZlbnQgb2JqZWN0XHJcbiAgICAgICAgcGlubmVkRXZlbnRzOiBzdGF0ZS5waW5uZWRFdmVudHMuY29uY2F0KGFjdGlvbi5wYXlsb2FkLl9pZCksXHJcbiAgICAgIH07XHJcbiAgICBjYXNlIFwiVU5QSU5fRVZFTlRcIjpcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICAuLi5zdGF0ZSxcclxuICAgICAgICBwaW5uZWRFdmVudHM6IHN0YXRlLnBpbm5lZEV2ZW50cy5maWx0ZXIoXHJcbiAgICAgICAgICAoZXZlbnRJZCkgPT4gZXZlbnRJZCAhPT0gYWN0aW9uLnBheWxvYWQuX2lkXHJcbiAgICAgICAgKSxcclxuICAgICAgfTtcclxuICAgIGNhc2UgXCJERUxFVEVfRVZFTlRcIjpcclxuICAgICAgRXZlbnRBUEkuZGVsZXRlRXZlbnQoYWN0aW9uLnBheWxvYWQsIGZ1bmN0aW9uIChwYXlsb2FkKSB7XHJcbiAgICAgICAgYWN0aW9uLmRpc3BhdGNoKHtcclxuICAgICAgICAgIHR5cGU6IFwiUkVNT1ZFX0VWRU5UX0ZST01fU1RBVEVcIixcclxuICAgICAgICAgIHBheWxvYWQ6IGFjdGlvbi5wYXlsb2FkLFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIHN0YXRlO1xyXG4gICAgY2FzZSBcIlVQREFURV9FVkVOVFwiOlxyXG4gICAgICBFdmVudEFQSS51cGRhdGVFdmVudChhY3Rpb24ucGF5bG9hZCwgKHBheWxvYWQpID0+XHJcbiAgICAgICAgYWN0aW9uLmRpc3BhdGNoKHtcclxuICAgICAgICAgIHR5cGU6IFwiR0VUX0VWRU5UXCIsXHJcbiAgICAgICAgICBwYXlsb2FkOiBwYXlsb2FkLFxyXG4gICAgICAgICAgZGlzcGF0Y2g6IGFjdGlvbi5kaXNwYXRjaCxcclxuICAgICAgICB9KVxyXG4gICAgICApO1xyXG4gICAgICByZXR1cm4gc3RhdGU7XHJcbiAgICBjYXNlIFwiUkVNT1ZFX0VWRU5UX0ZST01fU1RBVEVcIjpcclxuICAgICAgbGV0IG5ld0V2ZW50c18gPSB7XHJcbiAgICAgICAgLi4uc3RhdGUuZXZlbnRzLFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgbmV3UGlubmVkRXZlbnRzID0gc3RhdGUucGlubmVkRXZlbnRzLmZpbHRlcihcclxuICAgICAgICAocGlubmVkRXZlbnQpID0+IHBpbm5lZEV2ZW50Ll9pZCAhPT0gYWN0aW9uLnBheWxvYWRcclxuICAgICAgKTtcclxuICAgICAgbmV3VmlzaWJsZUV2ZW50cyA9IHN0YXRlLnZpc2libGVFdmVudHMuZmlsdGVyKFxyXG4gICAgICAgIChldmVudCkgPT4gZXZlbnQuX2lkICE9PSBhY3Rpb24ucGF5bG9hZFxyXG4gICAgICApO1xyXG4gICAgICAvKiBjb3B5aW5nIHRoaXMgc28gY29uc3VtZXJzIHJlY2VpdmUgdXBkYXRlcyAqL1xyXG4gICAgICBkZWxldGUgbmV3RXZlbnRzX1thY3Rpb24ucGF5bG9hZF07XHJcblxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIC4uLnN0YXRlLFxyXG4gICAgICAgIGV2ZW50czogbmV3RXZlbnRzXyxcclxuICAgICAgICBwaW5uZWRFdmVudHM6IG5ld1Bpbm5lZEV2ZW50cyxcclxuICAgICAgICB2aXNpYmxlRXZlbnRzOiBuZXdWaXNpYmxlRXZlbnRzLFxyXG4gICAgICB9O1xyXG4gICAgY2FzZSBcIkNPTUJJTkVfUElOTkVEX0VWRU5UU1wiOlxyXG4gICAgICBsZXQgcGlubmVkRXZlbnRPYmplY3RzID0gc3RhdGUucGlubmVkRXZlbnRzLm1hcCgoaWQpID0+IHN0YXRlLmV2ZW50c1tpZF0pO1xyXG4gICAgICBFdmVudEFQSS5jb21iaW5lRXZlbnRzKHBpbm5lZEV2ZW50T2JqZWN0cyk7XHJcbiAgICAgIHJldHVybiBzdGF0ZTsgLy8gVE9ET1xyXG5cclxuICAgIC8qIExBQkVMICovXHJcbiAgICBjYXNlIFwiR0VUX0FMTF9MQUJFTFNcIjpcclxuICAgICAgTGFiZWxBUEkuZ2V0QWxsTGFiZWxzKGZ1bmN0aW9uIChwYXlsb2FkKSB7XHJcbiAgICAgICAgYWN0aW9uLmRpc3BhdGNoKHsgdHlwZTogXCJNRVJHRV9BTExfTEFCRUxTXCIsIHBheWxvYWQgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gc3RhdGU7XHJcbiAgICBjYXNlIFwiTUVSR0VfQUxMX0xBQkVMU1wiOlxyXG4gICAgICBsZXQgbmV3X2xhYmVscyA9IGFjdGlvbi5wYXlsb2FkLmZpbHRlcihcclxuICAgICAgICAobmV3X2xhYmVsKSA9PlxyXG4gICAgICAgICAgIXN0YXRlLmxhYmVscy5maW5kKChzdGF0ZV9sYWJlbCkgPT4gc3RhdGVfbGFiZWwuX2lkID09PSBuZXdfbGFiZWwuX2lkKVxyXG4gICAgICApO1xyXG5cclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICAuLi5zdGF0ZSxcclxuICAgICAgICBsYWJlbHM6IFsuLi5zdGF0ZS5sYWJlbHMsIC4uLm5ld19sYWJlbHNdLFxyXG4gICAgICB9O1xyXG4gICAgY2FzZSBcIkNSRUFURV9MQUJFTFwiOlxyXG4gICAgICBMYWJlbEFQSS5jcmVhdGVMYWJlbChhY3Rpb24ucGF5bG9hZCwgZnVuY3Rpb24gKHBheWxvYWQpIHtcclxuICAgICAgICBhY3Rpb24uZGlzcGF0Y2goe1xyXG4gICAgICAgICAgdHlwZTogXCJHRVRfTEFCRUxcIixcclxuICAgICAgICAgIHBheWxvYWQsXHJcbiAgICAgICAgICBkaXNwYXRjaDogYWN0aW9uLmRpc3BhdGNoLFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIHN0YXRlO1xyXG4gICAgY2FzZSBcIkdFVF9MQUJFTFwiOlxyXG4gICAgICBMYWJlbEFQSS5nZXRMYWJlbChhY3Rpb24ucGF5bG9hZCwgZnVuY3Rpb24gKHBheWxvYWQpIHtcclxuICAgICAgICBhY3Rpb24uZGlzcGF0Y2goeyB0eXBlOiBcIk1FUkdFX0xBQkVMXCIsIHBheWxvYWQgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gc3RhdGU7XHJcbiAgICBjYXNlIFwiTUVSR0VfTEFCRUxcIjpcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICAuLi5zdGF0ZSxcclxuICAgICAgICBsYWJlbHM6IHN0YXRlLmxhYmVscy5jb25jYXQoYWN0aW9uLnBheWxvYWQpLFxyXG4gICAgICB9O1xyXG4gICAgY2FzZSBcIkRFTEVURV9MQUJFTFwiOlxyXG4gICAgICBMYWJlbEFQSS5kZWxldGVMYWJlbChhY3Rpb24ucGF5bG9hZCwgZnVuY3Rpb24gKHBheWxvYWQpIHtcclxuICAgICAgICBhY3Rpb24uZGlzcGF0Y2goe1xyXG4gICAgICAgICAgdHlwZTogXCJSRU1PVkVfTEFCRUxfRlJPTV9TVEFURVwiLFxyXG4gICAgICAgICAgcGF5bG9hZDogYWN0aW9uLnBheWxvYWQsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gc3RhdGU7XHJcbiAgICBjYXNlIFwiUkVNT1ZFX0xBQkVMX0ZST01fU1RBVEVcIjpcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICAuLi5zdGF0ZSxcclxuICAgICAgICBsYWJlbHM6IHN0YXRlLmxhYmVscy5maWx0ZXIoKGxhYmVsKSA9PiBsYWJlbC5faWQgIT09IGFjdGlvbi5wYXlsb2FkKSxcclxuICAgICAgfTtcclxuXHJcbiAgICBjYXNlIFwiR0VUX0FMTF9DT01NRU5UU1wiOlxyXG4gICAgICBDb21tZW50QVBJLmdldEFsbENvbW1lbnRzKGFjdGlvbi5wYXlsb2FkLCBmdW5jdGlvbiAocGF5bG9hZCkge1xyXG4gICAgICAgIGFjdGlvbi5kaXNwYXRjaCh7XHJcbiAgICAgICAgICB0eXBlOiBcIlNFVF9DT01NRU5UU1wiLFxyXG4gICAgICAgICAgcGF5bG9hZCxcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICAgIHJldHVybiBzdGF0ZTtcclxuXHJcbiAgICBjYXNlIFwiR0VUX0VWRU5UX0NPTU1FTlRTXCI6XHJcbiAgICAgIENvbW1lbnRBUEkuZ2V0RXZlbnRDb21tZW50cyhhY3Rpb24ucGF5bG9hZCwgZnVuY3Rpb24gKHBheWxvYWQpIHtcclxuICAgICAgICBhY3Rpb24uZGlzcGF0Y2goe1xyXG4gICAgICAgICAgdHlwZTogXCJTRVRfQ09NTUVOVFNcIixcclxuICAgICAgICAgIHBheWxvYWQsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gc3RhdGU7XHJcbiAgICBjYXNlIFwiU0VUX0NPTU1FTlRTXCI6XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgLi4uc3RhdGUsXHJcbiAgICAgICAgY29tbWVudHM6IGFjdGlvbi5wYXlsb2FkLFxyXG4gICAgICB9O1xyXG4gICAgY2FzZSBcIkNSRUFURV9DT01NRU5UXCI6XHJcbiAgICAgIENvbW1lbnRBUEkuY3JlYXRlQ29tbWVudChhY3Rpb24ucGF5bG9hZCk7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgLi4uc3RhdGUsXHJcbiAgICAgICAgY29tbWVudHM6IFsuLi5zdGF0ZS5jb21tZW50cywgYWN0aW9uLnBheWxvYWRdLFxyXG4gICAgICB9O1xyXG4gICAgY2FzZSBcIk1FUkdFX0NPTU1FTlRTXCI6XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgLi4uc3RhdGUsXHJcbiAgICAgICAgY29tbWVudHM6IHN0YXRlLmNvbW1lbnRzLmNvbmNhdChhY3Rpb24ucGF5bG9hZCksXHJcbiAgICAgIH07XHJcbiAgICBjYXNlIFwiVVBEQVRFX0VYUEFOREVEX1NZU1RFTUFfTk9ERVNcIjpcclxuICAgICAgcmV0dXJuIHsgLi4uc3RhdGUsIGV4cGFuZGVkU3lzdGVtYU5vZGVzOiBhY3Rpb24ucGF5bG9hZCB9O1xyXG4gICAgY2FzZSBcIlVQREFURV9TRUxFQ1RFRF9TWVNURU1BX05PREVTXCI6XHJcbiAgICAgIHJldHVybiB7IC4uLnN0YXRlLCBzZWxlY3RlZFN5c3RlbWFOb2RlczogYWN0aW9uLnBheWxvYWQgfTtcclxuICAgIGNhc2UgXCJFWFBBTkRfQUxMX1NZU1RFTUFfTk9ERVNcIjpcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICAuLi5zdGF0ZSxcclxuICAgICAgICBleHBhbmRlZFN5c3RlbWFOb2RlczogT2JqZWN0LmtleXMoc3RhdGUuc3lzdGVtYU5vZGVzKSxcclxuICAgICAgfTtcclxuICAgIGNhc2UgXCJDT0xMQVBTRV9BTExfU1lTVEVNQV9OT0RFU1wiOlxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIC4uLnN0YXRlLFxyXG4gICAgICAgIGV4cGFuZGVkU3lzdGVtYU5vZGVzOiBbXSxcclxuICAgICAgfTtcclxuICAgIGNhc2UgXCJPUEVOX0VWRU5UX0RFVEFJTFNcIjpcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICAuLi5zdGF0ZSxcclxuICAgICAgICBldmVudERldGFpbHNPcGVuOiB0cnVlLFxyXG4gICAgICAgIGV2ZW50RGV0YWlsc0V2ZW50VUlEOiBhY3Rpb24ucGF5bG9hZCxcclxuICAgICAgfTtcclxuICAgIGNhc2UgXCJDTE9TRV9FVkVOVF9ERVRBSUxTXCI6XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgLi4uc3RhdGUsXHJcbiAgICAgICAgZXZlbnREZXRhaWxzT3BlbjogZmFsc2UsXHJcbiAgICAgIH07XHJcbiAgICAvKiBFVkVOVCBGSUxURVIgKi9cclxuICAgIGNhc2UgXCJVUERBVEVfRklMVEVSRURfRVZFTlRTXCI6XHJcbiAgICAgIC8qIFRoaXMgYWN0aW9uIGlzIGRpc3BhdGNoZWQgYWZ0ZXIgZXZlcnkgZXZlbnQgZmlsdGVyIGFjdGlvbi5cclxuICAgICAgYHZpc2libGVFdmVudHNgIG9iamVjdCBnZXRzIG11dGF0ZWQgaGVyZS4gKi9cclxuXHJcbiAgICAgIGZ1bmN0aW9uIGlzVmlzaWJsZShzdGF0ZSwgZXZlbnQpIHtcclxuICAgICAgICAvLyBzZXZlcml0eVxyXG4gICAgICAgIHNlbGVjdGVkU2V2ZXJpdGllcyA9IGFjdGlvbi5wYXlsb2FkLmV2ZW50RmlsdGVyLnNlbGVjdGVkU2V2ZXJpdGllcztcclxuICAgICAgICBleGNsdWRlZExhYmVscyA9IGFjdGlvbi5wYXlsb2FkLmV2ZW50RmlsdGVyLmV4Y2x1ZGVkTGFiZWxzO1xyXG4gICAgICAgIGNvbnN0IHNldmVyaXR5ID0gZXZlbnQuc2V2ZXJpdHk7XHJcblxyXG4gICAgICAgIC8vIGZyZWUgdGV4dFxyXG4gICAgICAgIGNvbnN0IGZyZWVUZXh0ID0gYWN0aW9uLnBheWxvYWQuZXZlbnRGaWx0ZXIuZnJlZVRleHQ7XHJcbiAgICAgICAgY29uc3QgbWF0Y2hlc0ZyZWVUZXh0ID1cclxuICAgICAgICAgIGZyZWVUZXh0ID09IFwiXCIgfHwgIWZyZWVUZXh0XHJcbiAgICAgICAgICAgID8gdHJ1ZVxyXG4gICAgICAgICAgICA6IGV2ZW50LmRlc2NyaXB0aW9uXHJcbiAgICAgICAgICAgID8gZXZlbnQuZGVzY3JpcHRpb24udG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhmcmVlVGV4dC50b0xvd2VyQ2FzZSgpKVxyXG4gICAgICAgICAgICA6IGZhbHNlO1xyXG5cclxuICAgICAgICAvLyBsYWJlbFxyXG4gICAgICAgIGNvbnN0IGV4Y2x1ZGVkQnlMYWJlbCA9IGV4Y2x1ZGVkTGFiZWxzLnJlZHVjZShcclxuICAgICAgICAgIChleGNsdWRlZCwgZXhjbHVkZWRMYWJlbCkgPT5cclxuICAgICAgICAgICAgZXhjbHVkZWQgfHwgZXZlbnQubGFiZWwuaW5jbHVkZXMoZXhjbHVkZWRMYWJlbCksXHJcbiAgICAgICAgICBmYWxzZVxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIC8vIGV2ZW50IGRhdGUgb3IgY3JlYXRpb24gZGF0ZVxyXG4gICAgICAgIGNvbnN0IGV2ZW50U3RhcnQgPSBwYXJzZUlTTyhldmVudC5zdGFydCk7XHJcbiAgICAgICAgY29uc3QgZXZlbnRFbmQgPSBwYXJzZUlTTyhldmVudC5lbmQpO1xyXG4gICAgICAgIGNvbnN0IHNlbGVjdGlvbkZyb20gPSBhY3Rpb24ucGF5bG9hZC50aW1lU2VsZWN0aW9uLmZyb207XHJcbiAgICAgICAgY29uc3Qgc2VsZWN0aW9uVG8gPSBhY3Rpb24ucGF5bG9hZC50aW1lU2VsZWN0aW9uLnRvO1xyXG4gICAgICAgIC8vIGluY2x1ZGUgZXZlbnRzIHRoYXQgaGF2ZSBzb21lIG92ZXJsYXAgd2l0aCB0aGUgdGltZSBzZWxlY3Rpb25cclxuICAgICAgICAvLyAoY2FuIHJlYWNoIG91dCBsZWZ0IGFuZC9vciByaWdodCBvdXQgb2YgdGhlIHNlbGVjdGlvbilcclxuXHJcbiAgICAgICAgY29uc3QgZXhjbHVkZWRCeVRpbWVTZWxlY3Rpb24gPSBhY3Rpb24ucGF5bG9hZC5ldmVudEZpbHRlclxyXG4gICAgICAgICAgLm9ubHlTZWxlY3RlZFRpbWVSYW5nZVxyXG4gICAgICAgICAgPyBzZWxlY3Rpb25Gcm9tID49IGV2ZW50RW5kIHx8IHNlbGVjdGlvblRvIDw9IGV2ZW50U3RhcnRcclxuICAgICAgICAgIDogZmFsc2U7XHJcblxyXG4gICAgICAgIC8vIGNyZWF0aW9uIGRhdGVcclxuICAgICAgICBjb25zdCBjcmVhdGVEYXRlID0gcGFyc2VJU08oZXZlbnQuY3JlYXRlRGF0ZSk7XHJcbiAgICAgICAgY29uc3QgZXhjbHVkZWRCeUNyZWF0ZURhdGUgPSBhY3Rpb24ucGF5bG9hZC5ldmVudEZpbHRlclxyXG4gICAgICAgICAgLm9ubHlTZWxlY3RlZENyZWF0ZVRpbWVSYW5nZVxyXG4gICAgICAgICAgPyAhKHNlbGVjdGlvbkZyb20gPD0gY3JlYXRlRGF0ZSAmJiBjcmVhdGVEYXRlIDw9IHNlbGVjdGlvblRvKVxyXG4gICAgICAgICAgOiBmYWxzZTtcclxuXHJcbiAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgIHNlbGVjdGVkU2V2ZXJpdGllcy5pbmNsdWRlcyhzZXZlcml0eSkgJiZcclxuICAgICAgICAgICFleGNsdWRlZEJ5TGFiZWwgJiZcclxuICAgICAgICAgIG1hdGNoZXNGcmVlVGV4dCAmJlxyXG4gICAgICAgICAgIWV4Y2x1ZGVkQnlUaW1lU2VsZWN0aW9uICYmXHJcbiAgICAgICAgICAhZXhjbHVkZWRCeUNyZWF0ZURhdGVcclxuICAgICAgICApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBldmVudHMgPSBhY3Rpb24ucGF5bG9hZC5ldmVudHM7XHJcblxyXG4gICAgICBjb25zdCB2aXNpYmxlRXZlbnRzID0gZXZlbnRzXHJcbiAgICAgICAgPyBPYmplY3QudmFsdWVzKGV2ZW50cykuZmlsdGVyKFxyXG4gICAgICAgICAgICAoZXZlbnQpID0+IChyZXMgPSBpc1Zpc2libGUoc3RhdGUsIGV2ZW50KSlcclxuICAgICAgICAgIClcclxuICAgICAgICA6IFtdO1xyXG5cclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICAuLi5zdGF0ZSxcclxuICAgICAgICB0aW1lU2VsZWN0aW9uOiBhY3Rpb24ucGF5bG9hZC50aW1lU2VsZWN0aW9uLFxyXG4gICAgICAgIGV2ZW50czogYWN0aW9uLnBheWxvYWQuZXZlbnRzLFxyXG4gICAgICAgIGV2ZW50RmlsdGVyOiBhY3Rpb24ucGF5bG9hZC5ldmVudEZpbHRlcixcclxuICAgICAgICB2aXNpYmxlRXZlbnRzOiB2aXNpYmxlRXZlbnRzLFxyXG4gICAgICB9O1xyXG5cclxuICAgIGNhc2UgXCJVUERBVEVfRVZFTlRfRklMVEVSX1NFVkVSSVRJRVNcIjpcclxuICAgICAgYWN0aW9uLmRpc3BhdGNoKHtcclxuICAgICAgICB0eXBlOiBcIlVQREFURV9GSUxURVJFRF9FVkVOVFNcIixcclxuICAgICAgICBwYXlsb2FkOiB7XHJcbiAgICAgICAgICAuLi5zdGF0ZSxcclxuICAgICAgICAgIGV2ZW50RmlsdGVyOiB7XHJcbiAgICAgICAgICAgIC4uLnN0YXRlLmV2ZW50RmlsdGVyLFxyXG4gICAgICAgICAgICBzZWxlY3RlZFNldmVyaXRpZXM6IGFjdGlvbi5wYXlsb2FkLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICB9LFxyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIHN0YXRlO1xyXG5cclxuICAgIGNhc2UgXCJVUERBVEVfRVZFTlRfRklMVEVSX0xBQkVMU1wiOlxyXG4gICAgICBsYWJlbElkID0gYWN0aW9uLnBheWxvYWQuX2lkO1xyXG5cclxuICAgICAgaXNBbHJlYWR5RXhjbHVkZWQgPSBzdGF0ZS5ldmVudEZpbHRlci5leGNsdWRlZExhYmVscy5pbmNsdWRlcyhsYWJlbElkKTtcclxuICAgICAgZXhjbHVkZWRMYWJlbHMgPSBpc0FscmVhZHlFeGNsdWRlZFxyXG4gICAgICAgID8gZXhjbHVkZWRMYWJlbHMuZmlsdGVyKFxyXG4gICAgICAgICAgICAoZXhjbHVkZWRMYWJlbElkKSA9PiBsYWJlbElkICE9PSBleGNsdWRlZExhYmVsSWRcclxuICAgICAgICAgIClcclxuICAgICAgICA6IFsuLi5zdGF0ZS5ldmVudEZpbHRlci5leGNsdWRlZExhYmVscywgbGFiZWxJZF07XHJcblxyXG4gICAgICBhY3Rpb24uZGlzcGF0Y2goe1xyXG4gICAgICAgIHR5cGU6IFwiVVBEQVRFX0ZJTFRFUkVEX0VWRU5UU1wiLFxyXG4gICAgICAgIHBheWxvYWQ6IHtcclxuICAgICAgICAgIC4uLnN0YXRlLFxyXG4gICAgICAgICAgZXZlbnRGaWx0ZXI6IHtcclxuICAgICAgICAgICAgLi4uc3RhdGUuZXZlbnRGaWx0ZXIsXHJcbiAgICAgICAgICAgIGV4Y2x1ZGVkTGFiZWxzOiBleGNsdWRlZExhYmVscyxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgfSxcclxuICAgICAgfSk7XHJcbiAgICAgIHJldHVybiBzdGF0ZTtcclxuXHJcbiAgICBjYXNlIFwiVVBEQVRFX0VWRU5UX0ZJTFRFUl9GUkVFX1RFWFRcIjpcclxuICAgICAgYWN0aW9uLmRpc3BhdGNoKHtcclxuICAgICAgICB0eXBlOiBcIlVQREFURV9GSUxURVJFRF9FVkVOVFNcIixcclxuICAgICAgICBwYXlsb2FkOiB7XHJcbiAgICAgICAgICAuLi5zdGF0ZSxcclxuICAgICAgICAgIGV2ZW50RmlsdGVyOiB7IC4uLnN0YXRlLmV2ZW50RmlsdGVyLCBmcmVlVGV4dDogYWN0aW9uLnBheWxvYWQgfSxcclxuICAgICAgICB9LFxyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIHN0YXRlO1xyXG5cclxuICAgIGNhc2UgXCJVUERBVEVfRVZFTlRfRklMVEVSX09OTFlfU0VMRUNURURfVElNRV9SQU5HRVwiOlxyXG4gICAgICBjb25zdCBvbmx5U2VsZWN0ZWRUaW1lUmFuZ2UgPSBzdGF0ZS5ldmVudEZpbHRlci5vbmx5U2VsZWN0ZWRUaW1lUmFuZ2U7XHJcbiAgICAgIGNvbnN0IG9ubHlTZWxlY3RlZENyZWF0ZVRpbWVSYW5nZSA9XHJcbiAgICAgICAgc3RhdGUuZXZlbnRGaWx0ZXIub25seVNlbGVjdGVkQ3JlYXRlVGltZVJhbmdlO1xyXG4gICAgICBjb25zdCBkYXRlVHlwZSA9IGFjdGlvbi5wYXlsb2FkO1xyXG5cclxuICAgICAgZGF0ZVR5cGUgPT09IFwiZXZlbnRcIlxyXG4gICAgICAgID8gYWN0aW9uLmRpc3BhdGNoKHtcclxuICAgICAgICAgICAgdHlwZTogXCJVUERBVEVfRklMVEVSRURfRVZFTlRTXCIsXHJcbiAgICAgICAgICAgIHBheWxvYWQ6IHtcclxuICAgICAgICAgICAgICAuLi5zdGF0ZSxcclxuICAgICAgICAgICAgICBldmVudEZpbHRlcjoge1xyXG4gICAgICAgICAgICAgICAgLi4uc3RhdGUuZXZlbnRGaWx0ZXIsXHJcbiAgICAgICAgICAgICAgICBvbmx5U2VsZWN0ZWRUaW1lUmFuZ2U6ICFvbmx5U2VsZWN0ZWRUaW1lUmFuZ2UsXHJcbiAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgOiBhY3Rpb24uZGlzcGF0Y2goe1xyXG4gICAgICAgICAgICB0eXBlOiBcIlVQREFURV9GSUxURVJFRF9FVkVOVFNcIixcclxuICAgICAgICAgICAgcGF5bG9hZDoge1xyXG4gICAgICAgICAgICAgIC4uLnN0YXRlLFxyXG4gICAgICAgICAgICAgIGV2ZW50RmlsdGVyOiB7XHJcbiAgICAgICAgICAgICAgICAuLi5zdGF0ZS5ldmVudEZpbHRlcixcclxuICAgICAgICAgICAgICAgIG9ubHlTZWxlY3RlZENyZWF0ZVRpbWVSYW5nZTogIW9ubHlTZWxlY3RlZENyZWF0ZVRpbWVSYW5nZSxcclxuICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgIHJldHVybiBzdGF0ZTtcclxuXHJcbiAgICBkZWZhdWx0OlxyXG4gICAgICBjb25zb2xlLndhcm4oXCJyZWR1Y2VyOiBjYW5ub3QgaGFuZGxlIGFjdGlvbiB3aXRoIHVua25vd24gdHlwZSFcIiwgYWN0aW9uKTtcclxuICAgICAgcmV0dXJuIHN0YXRlO1xyXG4gIH1cclxufVxyXG4iXX0=